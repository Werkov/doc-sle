<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="sle_update_offline.xml" version="5.0" xml:id="cha.update.offline">
 <title>Offline-Aktualisierungen</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>Ja</dm:translation>
  </dm:docmanager>
  <abstract>
   <para>
    In diesem Kapitel finden Sie Anweisungen zum Aktualisieren einer vorhandenen SUSE Linux Enterprise-Installation mithilfe von YaST, das von einem Installationsmedium gebootet wird. Das YaST-Installationsprogramm kann beispielsweise von einer DVD oder über das Netzwerk bzw. auch von der Festplatte, auf der sich das System befindet, gestartet werden.
   </para>
  </abstract>
 </info>
 <sect1 xml:id="sec.update.offline.conceptual-overview">
  <title>Konzeptüberblick</title>
  <para>
   Vor dem Aufrüsten des Systems lesen Sie bitte zunächst <xref linkend="sec.update.prep"/>.
  </para>
  <para>
   Zum Aufrüsten des Systems booten Sie von einer Installationsquelle, ebenso wie bei einer Neuinstallation. Im Bootbildschirm wählen Sie dabei jedoch <guimenu>Aufrüsten</guimenu> (statt <guimenu>Installation</guimenu>). Die Aufrüstung kann wie folgt gestartet werden:
  </para>

  <itemizedlist>
   <listitem>
    <formalpara>
     <title>Wechselmedien</title>
     <para>
      Dies sind Medien wie CDs, DVDs oder USB-Massenspeichergeräte. Weitere Informationen finden Sie unter <xref linkend="sec.update.offline.dvd"/>.
     </para>
    </formalpara>
   </listitem>
   <listitem>
    <formalpara>
     <title>Netzwerk Ressource</title>
     <para>
      Sie können wahlweise vom lokalen Medium booten und dann den entsprechenden Netzwerkinstallationstyp auswählen oder über PXE booten. Weitere Informationen finden Sie unter <xref linkend="sec.update.offline.network"/>.
     </para>
    </formalpara>
   </listitem>
  </itemizedlist>
 </sect1>


 <sect1 xml:id="sec.update.offline.dvd">
  <title>Starten der Aufrüstung über ein Installationsmedium</title>
  <para>
   Im nachfolgenden Verfahren wird das Booten von DVD beschrieben. Sie können jedoch auch ein anderes lokales Installationsmedium verwenden, z. B. ein ISO-Image auf einem USB-Massenspeichergerät. Das Medium und die Bootmethode sind abhängig von der Systemarchitektur und von der Ausstattung des Systems (herkömmliches BIOS oder UEFI).
  </para>
  <procedure xml:id="pro.update.sle12.offline.dvd">
   <title>Manuelle Aufrüstung von SLE 11 SP4 auf SLE 12 SP5</title>
   <step>
    <para>
     Wählen Sie ein Bootmedium aus und bereiten Sie es vor, siehe <xref linkend="sec.i.yast2.startup"/>.
    </para>
   </step>
   <step>
    <para>
     Legen Sie DVD 4 des SUSE Linux Enterprise 12-SP1-Installationsmediums ein und booten Sie den Computer. Ein <guimenu>Begrüßungsbildschirm</guimenu> wird geöffnet, gefolgt vom Bootbildschirm.
    </para>
   </step>
   <step>
    <para>
     Starten Sie das System und wählen Sie im Bootmenü die Option <emphasis>Upgrade</emphasis>.
    </para>
   </step>
   <step>
    <para>
     Fahren Sie gemäß <xref linkend="sec.update.sle12.start.upgr.after.boot"/> mit der Installation fort.
    </para>
   </step>
  </procedure>
 </sect1>

 <sect1 xml:id="sec.update.offline.network">
  <title>Starten der Aufrüstung über eine Netzwerkquelle</title>
  <para>
   Zum Aufrüsten über eine Netzwerkinstallationsquelle müssen die folgenden Anforderungen erfüllt sein:
  </para>
  <variablelist>
   <title>Anforderungen für das Aufrüsten von einer Netzwerkinstallationsquelle</title>
   <varlistentry>
    <term>Netzwerkinstallationsquelle</term>
    <listitem>
     <para>
      Eine Netzwerkinstallationsquelle ist gemäß <xref linkend="cha.deployment.instserver"/> eingerichtet.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Netzwerkverbindung und Netzwerkdienste</term>
    <listitem>
     <para>
      Sowohl der Installationsserver als auch der Zielcomputer müssen eine funktionsfähige Netzwerkverbindung haben. Erforderliche Netzwerkdienste:
     </para>
     <itemizedlist>
      <listitem><para>Domänennamen-Service</para></listitem>
      <listitem><para>DHCP (nur beim Booten über PXE; IP-Adresse kann manuell bei der Einrichtung festgelegt werden)</para></listitem>
      <listitem><para>OpenSLP (optional)</para></listitem>
     </itemizedlist>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Bootmedium</term>
    <listitem>
     <para>
      Sie haben eine <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>-DVD 1 (oder ein lokales ISO-Image) zur Hand, mit dem Sie das Zielsystem booten können, <emphasis>oder</emphasis> ein Zielsystem, das gemäß <xref linkend="sec.deployment.prep_boot.pxeprep" xrefstyle="HeadingOnPage"/> für das Booten über PXE eingerichtet ist. Detaillierte Informationen zum Starten der Aufrüstung von einem Remote-Server finden Sie unter <xref linkend="cha.deployment.remoteinst"/>.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
  <sect2 xml:id="sec.update.sle.manual.network.boot-from-dvd">
   <title>Manuelle Aufrüstung von einer Netzwerkinstallationsquelle – Booten von DVD</title>
   <para>
    In diesem Verfahren wird das Booten von DVD als Beispiel beschrieben. Sie können jedoch auch ein anderes lokales Installationsmedium verwenden, z. B. ein ISO-Image auf einem USB-Massenspeichergerät. Das Verfahren zum Auswählen der Bootmethode und zum Starten des Systems vom Medium hängt von der Systemarchitektur und davon ab, ob der Computer mit einem herkömmlichen BIOS oder mit UEFI ausgestattet ist. Weitere Informationen finden Sie unter den nachfolgenden Links.
   </para>
   <procedure xml:id="pro.update.sle.manual.network.boot-from-dvd">

    <step>
     <para>
      Legen Sie DVD 4 des SUSE Linux Enterprise 12-SP1-Installationsmediums ein und booten Sie den Computer. Ein <guimenu>Begrüßungsbildschirm</guimenu> wird geöffnet, gefolgt vom Bootbildschirm.
     </para>
    </step>
    <step>
     <para>
      Wählen Sie die gewünschte Netzwerkinstallationsquelle aus (FTP, HTTP, NFS, SMB oder SLP). Diese Auswahl erhalten Sie in der Regel mit <keycap>F4</keycap>. Falls der Computer mit UEFI statt mit einem herkömmlichen BIOS ausgestattet ist, müssen Sie ggf. die Bootparameter manuell anpassen. Weitere Informationen finden Sie unter <xref linkend="sec.i.yast2.source.net"/> in <xref linkend="cha.inst"/>.
     </para>
    </step>
    <step>
     <para>
      Fahren Sie gemäß <xref linkend="sec.update.sle12.start.upgr.after.boot"/> mit der Installation fort.
     </para>
    </step>
   </procedure>
  </sect2>
  <sect2 xml:id="sec.update.sle.manual.network.pxe-boot">
   <title>Manuelle Aufrüstung von einer Netzwerkinstallationsquelle – Booten über PXE</title>
   <para>
    So führen Sie die Aufrüstung von einer Netzwerkinstallationsquelle mit dem PXE-Boot aus:
   </para>
   <procedure xml:id="pro.update.sle.manual.network.pxe-boot">
    <step>
     <para>
      Passen Sie das Setup Ihres DHCP-Servers an, damit die für den PXE-Boot erforderlichen Adressinformationen angegeben werden. Weitere Informationen finden Sie unter <xref linkend="sec.deployment.prep_boot.pxeprep"/>.
     </para>
    </step>
    <step>
     <para>
      Richten Sie einen TFTP-Server ein, auf dem das Boot-Image für das Booten über PXE abgelegt wird. Nutzen Sie hierfür DVD 4 des SUSE Linux Enterprise-Service Packs oder befolgen Sie die Anweisungen in <xref linkend="sec.deployment.prep_boot.tftp"/>.
     </para>
    </step>
    <step>
     <para>
      Bereiten Sie den PXE-Boot und Wake-on-LAN auf dem Zielcomputer vor.
     </para>
    </step>
    <step>
     <para>
      Starten Sie den Boot des Zielsystems und verwenden Sie VNC, um sich entfernt mit der auf diesem Computer ausgeführten Installationsroutine zu verbinden. Weitere Informationen finden Sie unter <xref linkend="sec.deployment.remoteinst.monitor.vnc"/>.
     </para>
    </step>
    <step>
     <para>
      Fahren Sie gemäß <xref linkend="sec.update.sle12.start.upgr.after.boot"/> mit der Installation fort.
     </para>
    </step>
   </procedure>
  </sect2>
 </sect1>

 <sect1 xml:id="sec.update.offline.automated">
  <title>Aktivieren der automatischen Aufrüstung</title>
  <para>
   Die Aufrüstung kann bei Bedarf automatisch ausgeführt werden. Zum Aktivieren der automatischen Aufrüstung muss der Kernel-Parameter <literal>autoupgrade=1</literal> festgelegt werden. Der Parameter kann beim Booten im Feld <literal>Bootoptionen</literal> angegeben werden. Weitere Informationen finden Sie in <link xlink:href="https://www.suse.com/documentation/sles-12/book_autoyast/data/introduction.html"/>.
  </para>
 </sect1>
 <sect1 xml:id="sec.update.sle12.start.upgr.after.boot">
  <title>Aufrüsten von SUSE Linux Enterprise</title>
  <para>
   <remark>taroth 2014-11-13: argh, the following is terminology hell regarding
     the software strings: "upgrade"/"update" are used intermittently and
     without clear differentiation...</remark>
  </para>
  <para>
   Vor dem Aufrüsten des Systems beachten Sie <xref linkend="sec.update.prep"/> Gehen Sie folgendermaßen vor, um eine automatische Migration auszuführen:
  </para>
  <procedure>
   <step>
    <para>
     Nach dem Booten (von einem Installationsmedium oder über das Netzwerk) wählen Sie im Bootbildschirm die Option <guimenu>Aufrüsten. </guimenu> Soll die Aufrüstung gemäß den nachfolgenden Anweisungen manuell vorgenommen werden, deaktivieren Sie die automatische Aufrüstung. Weitere Informationen finden Sie in <xref linkend="sec.update.offline.automated"/>.
    </para>
    <warning>
     <title>Möglicher Datenverlust durch falsche Auswahl</title>
     <para>
      Wenn Sie <guimenu>Installation</guimenu> statt <guimenu>Aufrüsten</guimenu> wählen, können später Daten verlorengehen. Achten Sie besonders darauf, Ihre Datenpartitionen nicht versehentlich mit einer Neuinstallation zu zerstören.
     </para>
     <para>
      Wählen Sie hier in jedem Fall die Option <guimenu>Aufrüsten</guimenu>.
     </para>
    </warning>
    <para>
     YaST startet das Installationssystem.
    </para>
   </step>
   <step>
    <para>
     Wählen Sie im <guimenu>Willkommen</guimenu>-Bildschirm die <guimenu>Sprache</guimenu> und die Belegung der <guimenu>Tastatur</guimenu> aus und nehmen Sie die Lizenzvereinbarung an. Fahren Sie mit <guimenu>Weiter</guimenu> fort.
    </para>
    <para>
     YaST sucht auf den Partitionen nach bereits installierten SUSE Linux Enterprise-Systemen.
    </para>
   </step>
   <step>
    <para>
     Wählen Sie im Bildschirm <guimenu>Zum Aufrüsten auswählen</guimenu> die aufzurüstende Partition aus und klicken Sie auf <guimenu>Weiter</guimenu>.
    </para>
    <para>
     YaST hängt die ausgewählte Partition ein und zeigt alle Repositorys an, die sich in der aufzurüstenden Partition befinden.
    </para>
   </step>
   <step>
    <para>
     Passen Sie im Bildschirm <guimenu>Zuvor verwendete Repositorys</guimenu> den Status der Repositorys an: Aktivieren Sie die Repositorys, die beim Aufrüstungsprozess berücksichtigt werden sollen, und deaktivieren Sie alle nicht mehr benötigten Repositorys. Fahren Sie mit <guimenu>Weiter</guimenu> fort.
    </para>
   </step>
   <step>
    <para>
     Geben Sie im Bildschirm <guimenu>Registrierung</guimenu> an, dass das aufgerüstete System jetzt registriert werden soll (geben Sie hierzu Ihre Registrierungsdaten ein und klicken Sie auf <guimenu>Weiter</guimenu>) oder wählen Sie <guimenu>Registrierung überspringen</guimenu>. Weitere Informationen zum Registrieren des Systems finden Sie in <xref linkend="sec.update.registersystem"/>.
    </para>
   </step>
   <step>
    <para>
     Prüfen Sie die <guimenu>Installationseinstellungen</guimenu> für die Aufrüstung, insbesondere die <guimenu>Optionen für das Update</guimenu>. Folgende Optionen stehen zur Auswahl:
    </para>
    <itemizedlist>
     <listitem>
      <para>
       <guimenu>Nur installierte Pakete aktualisieren</guimenu>. Hierbei entgehen Ihnen allerdings ggf. neue Funktionen aus der aktuellen SUSE Linux Enterprise-Version.
      </para>
     </listitem>
     <listitem>
      <para>
       <guimenu>Update mit Installation neuer Software und neuer Funktionen</guimenu>. Mit <guimenu>Schemata auswählen</guimenu> können Sie die Schemata und Pakete je nach Bedarf aktivieren oder deaktivieren.
      </para>
     </listitem>
    </itemizedlist>

    <note>
     <title>Auswahl des Desktops</title>
     <para>
      Wenn Sie vor dem Aufrüsten auf SUSE Linux Enterprise 12 mit KDE gearbeitet haben (<varname>DEFAULT_WM</varname> in <filename>/etc/sysconfig/windowmanager</filename> war auf <literal>kde*</literal> eingestellt), wird die bisherige Desktop-Umgebung nach der Aufrüstung automatisch durch GNOME ersetzt. Standardmäßig wird der KDM-Anzeigemanager durch GDM ersetzt.
     </para>
     <para>
      Soll eine andere Desktop-Umgebung oder ein anderer Fenstermanager ausgewählt werden, klicken Sie auf <guimenu>Schemata auswählen</guimenu> und wählen Sie die gewünschte Option.
     </para>
    </note>
   </step>
   <step>
    <para>
     Wenn die Einstellungen Ihren Anforderungen entsprechen, starten Sie den Installations- und Löschvorgang mit <guimenu>Aktualisieren</guimenu>.
    </para>
   </step>
   <step>
    <para>
     Prüfen Sie nach dem erfolgreichen Abschluss des Upgradevorgangs, ob <quote>verwaiste Pakete</quote> vorhanden sind. Bei verwaisten Paketen handelt es sich um Pakete, die keinem aktiven Repository mehr angehören. Mit dem folgenden Kommando erhalten Sie eine entsprechende Liste:
    </para>
<screen>zypper packages --orphaned</screen>
    <para>
     Mithilfe dieser Liste können Sie entscheiden, ob ein Paket nach wie vor benötigt wird oder gefahrlos deinstalliert werden kann.
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec.update.sle.manager">
  <title>Aktualisieren über SUSE Manager</title>

  <para>
   SUSE Manager ist eine Serverlösung für die Bereitstellung von Aktualisierungen, Patches und Sicherheitsreparaturen für SUSE Linux Enterprise-Clients. Hier finden Sie eine Reihe von Werkzeugen und eine webgestützte Bedienoberfläche für Verwaltungsaufgaben. Weitere Informationen zu SUSE Manager finden Sie unter <link xlink:href="https://www.suse.com/products/suse-manager/"/>.
  </para>

  <para>
   SUSE Manager unterstützt Sie bei einer SP-Migration oder bei einer kompletten Systemaufrüstung.
  </para>

  <variablelist>

   <varlistentry>
    <term>SP-Migration</term>
    <listitem>
     <para>
      Bei der SP-Migration können Sie von einem bestimmten Service Pack (SP) auf ein anderes SP in derselben Hauptversion migrieren (z. B. von SLES 12 SP1 auf 12 SP2). Weitere Informationen finden Sie in den <citetitle>SUSE Manager Best Practices</citetitle> im Kapitel <quote>Client-Migration</quote>:
     </para>
     <para>
       <link xlink:href="https://www.suse.com/documentation/suse-manager/"/>, Version 3.1.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Systemaufrüstung</term>
    <listitem>
     <para>
      Mit SUSE Manager können Sie das System aufrüsten. Mit der integrierten AutoYaST-Technologie ist eine Aufrüstung von einer Hauptversion auf die nächste Hauptversion möglich (z. B. von SLES 11 SP3 auf 12 SP2). Weitere Informationen finden Sie in den <citetitle>SUSE Manager Best Practices</citetitle> im Kapitel <quote>Client-Migration</quote>.
     </para>
     <para>
      <link xlink:href="https://www.suse.com/documentation/suse-manager/"/>, Version 3.1.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
<para>
  <remark>taroth 2018-09-26: the SUMA docs do not cover migration to
   SLE 12 SP5 yet, therefore removed the specific section title from
   the pointers above and filed https://bugzilla.suse.com/show_bug.cgi?id=1109790
 </remark>
</para>
 </sect1>
 <sect1 xml:id="sec.update.reg.status.after.rollback">
  <title>Aktualisieren des Registrierungsstatus nach einem Rollback</title>

  <para>
   Bei einer Service Pack-Aufrüstung muss die Konfiguration auf dem Registrierungsserver geändert werden, um den Zugriff auf die neuen Repositorys zu ermöglichen. Wenn ein Aufrüstungsvorgang unterbrochen oder (durch Wiederherstellung auf Basis einer Sicherung oder eines Snapshots) rückgängig gemacht wird, stimmen die Informationen auf dem Registrierungsserver nicht mehr mit dem Status des Systems überein. Dies kann dazu führen, dass Sie nicht auf die Aktualisierungs-Repositorys zugreifen können oder die falschen Repositorys auf dem Client verwendet werden.
  </para>

  <para>
   Wenn über Snapper ein Rollback erfolgt, benachrichtigt das System den Registrierungsserver, um sicherzustellen, dass während des Bootvorgangs der Zugriff auf die richtigen Repositorys eingerichtet wird. Wenn das System auf andere Weise wiederhergestellt wurde oder aus irgendeinem Grund ein Fehler bei der Kommunikation mit dem Registrierungsserver auftrat (weil beispielsweise aufgrund von Netzwerkproblemen kein Zugriff auf den Server möglich war), lösen Sie das Rollback auf dem Client manuell aus, indem Sie Folgendes aufrufen:
  </para>

<screen><command>snapper</command> rollback</screen>

  <para>
   Es wird empfohlen, grundsätzlich zu prüfen, ob die richtigen Repositorys auf dem System eingerichtet wurden. Dies gilt insbesondere nach der Aktualisierung des Service mit:
  </para>

<screen><command>zypper</command> ref -s</screen>

  <para>
   Diese Funktionalität ist im
   <package>rollback-helper-</package>
   Paket verfügbar.
  </para>
 </sect1>
 <sect1 xml:id="sec.update.registersystem">


  <title>Registrieren des Systems</title>

  <para>
   Falls Sie die Registrierung während der Installation übersprungen hatten, können Sie das System jederzeit nachträglich mit dem YaST-Modul <guimenu>Produktregistrierung</guimenu> nachholen.
  </para>

  <para>
   Die Registrierung der Systeme bietet die folgenden Vorteile:
  </para>

  <itemizedlist>
   <listitem>
    <para>
     Recht für Support
    </para>
   </listitem>
   <listitem>
    <para>
     Bereitstellung von Sicherheitsaktualisierungen und Fehlerbehebungen
    </para>
   </listitem>
   <listitem>
    <para>
     Zugang zum SUSE Customer Center
    </para>
   </listitem>
  </itemizedlist>

  <procedure>
   <step>
    <para>
     Starten Sie YaST und wählen Sie <menuchoice> <guimenu>Software</guimenu>
     <guimenu>Produktregistrierung</guimenu> </menuchoice>. Das Dialogfeld <guimenu>Registrierung</guimenu> wird geöffnet.
    </para>
   </step>
   <step>
    <para>
     Geben Sie die <guimenu>Email</guimenu>-Adresse für das SUSE-Konto ein, mit dem Sie oder Ihr Unternehmen die Abonnements verwalten. Falls Sie noch kein SUSE-Konto besitzen, wechseln Sie zur SUSE Customer Center-Startseite (<link xlink:show="new" xlink:href="https://scc.suse.com/"/>), und erstellen Sie dort ein Konto.
    </para>
   </step>
   <step>
    <para>
     Geben Sie den <guimenu>Registrierungscode</guimenu> ein, den Sie zusammen mit Ihrem Exemplar von <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> erhalten haben.
    </para>
   </step>
   <step xml:id="step.y2.register.final">
    <para>
     Starten Sie die Registrierung mit <guimenu>Weiter</guimenu>. Wenn ein oder mehrere lokale Registrierungsserver in Ihrem Netzwerk verfügbar sind, können Sie einen Server aus einer Liste auswählen. Alternativ klicken Sie auf <guimenu>Abbrechen</guimenu>; damit ignorieren Sie die lokalen Registrierungsserver und die Registrierung erfolgt beim standardmäßigen SUSE-Registrierungsserver.
    </para>
    <para>
     Während der Registrierung werden die Online-Aktualisierungs-Repositorys zu Ihrer Upgrade-Einrichtung hinzugefügt. Abschließend können Sie angeben, ob die verfügbaren aktuellen Paketversionen über die Aktualisierungs-Repositorys installiert werden sollen. Damit erhalten Sie einen korrekten Upgradepfad für sämtliche Pakete und es ist sichergestellt, dass <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> stets mit den neuesten verfügbaren Sicherheitsaktualisierungen aufgerüstet wird. Mit <guimenu>Nein</guimenu> werden alle Pakete von den Installationsmedien installiert. Fahren Sie mit <guimenu>Weiter</guimenu> fort.
    </para>
    <para>
     Nach erfolgter Registrierung zeigt YaST eine Liste der verfügbaren Erweiterungen, Add-ons und Module für Ihr System an. Zum Auswählen und Installieren eines Elements fahren Sie mit <xref linkend="sec.add-ons.installation"/> fort.
    </para>
   </step>
  </procedure>
 </sect1>

</chapter>
