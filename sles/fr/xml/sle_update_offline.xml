<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="sle_update_offline.xml" version="5.0" xml:id="cha.update.offline">
 <title>Mise à niveau en mode hors ligne</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>oui</dm:translation>
  </dm:docmanager>
  <abstract>
   <para>
    Ce chapitre décrit la procédure de mise à niveau d'une installation SUSE Linux Enterprise existante à l'aide de YaST, qui est démarré à partir d'un support d'installation. Le programme d'installation de YaST peut, par exemple, être démarré à partir d'un DVD, du réseau ou du disque dur qui héberge le système.
   </para>
  </abstract>
 </info>
 <sect1 xml:id="sec.update.offline.conceptual-overview">
  <title>Présentation conceptuelle</title>
  <para>
   Avant d'entamer la mise à niveau de votre système, consultez la <xref linkend="sec.update.prep"/>.
  </para>
  <para>
   Pour mettre à niveau votre système, démarrez à partir d'une source d'installation, comme vous le feriez pour une nouvelle installation. Toutefois, lorsque l'écran de démarrage apparaît, vous devez sélectionner <guimenu>Mettre à niveau</guimenu> (au lieu d'<guimenu>Installation</guimenu>). La mise à niveau peut être démarrée à partir des éléments suivants :
  </para>

  <itemizedlist>
   <listitem>
    <formalpara>
     <title>Support amovible</title>
     <para>
      Il peut notamment s'agir d'un CD, d'un DVD ou d'un périphérique de stockage de masse USB. Pour plus d'informations, reportez-vous à la <xref linkend="sec.update.offline.dvd"/>.
     </para>
    </formalpara>
   </listitem>
   <listitem>
    <formalpara>
     <title>Ressource réseau</title>
     <para>
      Vous pouvez démarrer à partir d'un support local, puis sélectionner le type d'installation réseau respectif ou démarrez via PXE. Pour plus d'informations, reportez-vous à la <xref linkend="sec.update.offline.network"/>.
     </para>
    </formalpara>
   </listitem>
  </itemizedlist>
 </sect1>


 <sect1 xml:id="sec.update.offline.dvd">
  <title>Démarrage de la mise à niveau à partir d'un support d'installation</title>
  <para>
   La procédure ci-dessous décrit le démarrage à partir d'un DVD, mais vous pouvez également utiliser un support d'installation local comme une image ISO sur un périphérique de stockage de masse USB. Le support et la méthode de démarrage à sélectionner dépendent de l'architecture système et du fait que la machine dispose d'un BIOS traditionnel ou UEFI.
  </para>
  <procedure xml:id="pro.update.sle12.offline.dvd">
   <title>Mise à niveau manuelle de SLE 11 SP4 vers SLE 12 SP5</title>
   <step>
    <para>
     Sélectionnez et préparez un support de démarrage (voir <xref linkend="sec.i.yast2.startup"/>).
    </para>
   </step>
   <step>
    <para>
     Insérez le DVD 1 du support d'installation de SUSE Linux Enterprise 12 SP5 et démarrez votre machine. L'écran <guimenu>Bienvenue</guimenu> s'affiche, suivi de l'écran de démarrage.
    </para>
   </step>
   <step>
    <para>
     Démarrez le système en sélectionnant <emphasis>Mise à niveau</emphasis> dans le menu de démarrage.
    </para>
   </step>
   <step>
    <para>
     Effectuez la procédure de mise à niveau, comme décrit à la <xref linkend="sec.update.sle12.start.upgr.after.boot"/>.
    </para>
   </step>
  </procedure>
 </sect1>

 <sect1 xml:id="sec.update.offline.network">
  <title>Démarrage de la mise à niveau à partir d'une source réseau</title>
  <para>
   Pour démarrer une mise à niveau à partir d'une source d'installation réseau, veillez à respecter les conditions suivantes :
  </para>
  <variablelist>
   <title>Configuration requise pour la mise à niveau à partir d'une source d'installation réseau</title>
   <varlistentry>
    <term>Source d'installation réseau</term>
    <listitem>
     <para>
      Une source d'installation réseau est configurée conformément au <xref linkend="cha.deployment.instserver"/>.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Connexion réseau et services réseau</term>
    <listitem>
     <para>
      Le serveur d'installation et la machine cible doivent disposer d'une connexion réseau qui fonctionne. Les services réseau requis sont les suivants :
     </para>
     <itemizedlist>
      <listitem><para>Service de noms de domaines</para></listitem>
      <listitem><para>DHCP (uniquement nécessaire pour un lancement via PXE ; l'adresse IP peut être définie manuellement lors de la configuration)</para></listitem>
      <listitem><para>OpenSLP (facultatif)</para></listitem>
     </itemizedlist>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Support de démarrage</term>
    <listitem>
     <para>
      Vous disposez du 1er DVD de <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> (ou d'une image ISO locale) pour démarrer le système cible <emphasis>ou</emphasis> un système cible qui est configuré pour le démarrage via PXE comme indiqué à la <xref linkend="sec.deployment.prep_boot.pxeprep" xrefstyle="HeadingOnPage"/>. Reportez-vous au <xref linkend="cha.deployment.remoteinst"/> pour obtenir des informations détaillées sur le démarrage d'une mise à niveau à partir d'un serveur distant.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
  <sect2 xml:id="sec.update.sle.manual.network.boot-from-dvd">
   <title>Mise à niveau manuelle via une source d'installation réseau - démarrage à partir d'un DVD</title>
   <para>
    Cette procédure fournit l'exemple d'un démarrage à partir d'un DVD, mais vous pouvez également utiliser tout autre support d'installation local comme une image ISO sur un périphérique de stockage de masse USB. La façon de sélectionner la méthode de démarrage et de démarrer le système à partir du support dépend de l'architecture système. Vous devez également savoir si la machine est équipée d'un BIOS ou UEFI traditionnel. Pour plus de détails, reportez-vous aux liens ci-dessous.
   </para>
   <procedure xml:id="pro.update.sle.manual.network.boot-from-dvd">

    <step>
     <para>
      Insérez le DVD 1 du support d'installation SUSE Linux Enterprise 12 SP5 et démarrez votre machine. L'écran <guimenu>Bienvenue</guimenu> s'affiche, suivi de l'écran de démarrage.
     </para>
    </step>
    <step>
     <para>
      Sélectionnez le type de source d'installation réseau que vous souhaitez utiliser (FTP, HTTP, NFS, SMB ou SLP). En général, ce choix est disponible en appuyant sur la touche <keycap>F4</keycap>, mais si votre machine est équipée d'UEFI au lieu d'un BIOS traditionnel, vous devrez peut-être adapter manuellement les paramètres de démarrage. Pour plus de détails, reportez-vous à la section <xref linkend="sec.i.yast2.source.net"/> du <xref linkend="cha.inst"/>.
     </para>
    </step>
    <step>
     <para>
      Effectuez la procédure de mise à niveau, comme décrit à la <xref linkend="sec.update.sle12.start.upgr.after.boot"/>.
     </para>
    </step>
   </procedure>
  </sect2>
  <sect2 xml:id="sec.update.sle.manual.network.pxe-boot">
   <title>Mise à niveau manuelle via une source d'installation réseau - démarrage à partir de PXE</title>
   <para>
    Pour effectuer une mise à niveau à partir d'une source d'installation réseau à l'aide d'un démarrage PXE, procédez comme suit :
   </para>
   <procedure xml:id="pro.update.sle.manual.network.pxe-boot">
    <step>
     <para>
      Ajustez la configuration de votre serveur DHCP afin de fournir les informations relatives à l'adresse indispensables à un démarrage à l'aide de PXE. Pour plus de détails, reportez-vous à la <xref linkend="sec.deployment.prep_boot.pxeprep"/>.
     </para>
    </step>
    <step>
     <para>
      Configurez un serveur TFTP qui devra contenir l'image de démarrage requise pour un démarrage à l'aide de PXE. Pour ce faire, utilisez le DVD 1 du support d'installation de SUSE Linux Enterprise 12 SP5 ou suivez les instructions de la <xref linkend="sec.deployment.prep_boot.tftp"/>.
     </para>
    </step>
    <step>
     <para>
      Préparez le démarrage de PXE et de Wake-on-LAN sur l'ordinateur cible.
     </para>
    </step>
    <step>
     <para>
      Lancez le démarrage du système cible et utilisez VNC pour vous connecter à distance à la routine d'installation s'exécutant sur cet ordinateur. Pour plus d'informations, reportez-vous à la <xref linkend="sec.deployment.remoteinst.monitor.vnc"/>.
     </para>
    </step>
    <step>
     <para>
      Effectuez la procédure de mise à niveau, comme décrit à la <xref linkend="sec.update.sle12.start.upgr.after.boot"/>.
     </para>
    </step>
   </procedure>
  </sect2>
 </sect1>

 <sect1 xml:id="sec.update.offline.automated">
  <title>Activation de la mise à niveau automatique</title>
  <para>
   Le processus de mise à niveau peut être exécuté automatiquement. Pour activer la mise à jour automatique, le paramètre de kernel <literal>autoupgrade = 1</literal> doit être défini. Le paramètre peut être défini lors du démarrage dans le champ <literal>Options de démarrage</literal>. Pour plus de détails, consultez l'adresse <link xlink:href="https://www.suse.com/documentation/sles-12/book_autoyast/data/introduction.html"/>.
  </para>
 </sect1>
 <sect1 xml:id="sec.update.sle12.start.upgr.after.boot">
  <title>Mise à niveau de SUSE Linux Enterprise</title>
  <para>
   <remark>taroth 2014-11-13: argh, the following is terminology hell regarding
     the software strings: "upgrade"/"update" are used intermittently and
     without clear differentiation...</remark>
  </para>
  <para>
   Avant de mettre à niveau votre système, lisez d'abord la <xref linkend="sec.update.prep"/>. Pour effectuer une migration automatisée, procédez comme suit :
  </para>
  <procedure>
   <step>
    <para>
     Après avoir démarré (à partir d'un support d'installation ou du réseau), sélectionnez l'entrée <guimenu>Mise à niveau</guimenu> dans l'écran de démarrage. Si vous souhaitez effectuer la mise à niveau comme décrit dans les étapes suivantes manuellement, vous devez désactiver le processus de mise à niveau automatique. Reportez-vous à la <xref linkend="sec.update.offline.automated"/>.
    </para>
    <warning>
     <title>un choix erroné risque de vous faire perdre des données</title>
     <para>
      Si vous sélectionnez <guimenu>Installation</guimenu> au lieu de <guimenu>Mise à niveau</guimenu>, vous risquez de perdre des données ultérieurement. Veillez particulièrement à ne pas détruire vos partitions de données en effectuant une nouvelle installation.
     </para>
     <para>
      Veillez à bien sélectionner <guimenu>Mettre à niveau</guimenu> dans ce cas.
     </para>
    </warning>
    <para>
     YaST démarre le système d'installation.
    </para>
   </step>
   <step>
    <para>
     Dans l'écran <guimenu>Bienvenue</guimenu>, sélectionnez la <guimenu>Langue</guimenu> et le <guimenu>Clavier</guimenu>, puis acceptez l'accord de licence. Cliquez ensuite sur <guimenu>Suivant</guimenu>.
    </para>
    <para>
     YaST recherche dans vos partitions les systèmes SUSE Linux Enterprise déjà installés.
    </para>
   </step>
   <step>
    <para>
     Dans l'écran <guimenu>Sélectionner pour la mise à niveau</guimenu>, sélectionnez la partition à mettre à niveau et cliquez sur <guimenu>Suivant</guimenu>.
    </para>
    <para>
     YaST monte la partition sélectionnée et affiche tous les dépôts trouvés sur la partition que vous souhaitez mettre à niveau.
    </para>
   </step>
   <step>
    <para>
     Dans l'écran <guimenu>Dépôts utilisés précédemment</guimenu>, adaptez le statut des dépôts : cochez ceux que vous souhaitez inclure dans le processus de mise à niveau et désactivez ceux dont vous n'avez plus besoin. Cliquez ensuite sur <guimenu>Suivant</guimenu>.
    </para>
   </step>
   <step>
    <para>
     Dans l'écran <guimenu>Enregistrement</guimenu>, indiquez si vous voulez enregistrer le système mis à niveau maintenant (en introduisant vos données d'enregistrement et en cliquant sur <guimenu>Suivant</guimenu>) ou si vous préférez <guimenu>Ignorer l'enregistrement</guimenu> pour l'instant. Pour plus d'informations sur l'enregistrement de votre système, reportez-vous à la <xref linkend="sec.update.registersystem"/>.
    </para>
   </step>
   <step>
    <para>
     Passez en revue les <guimenu>paramètres d'installation</guimenu> de la mise à niveau, notamment les <guimenu>options de mise à jour</guimenu>. Sélectionnez l'une des options suivantes :
    </para>
    <itemizedlist>
     <listitem>
      <para>
       <guimenu>Mettre à jour uniquement les paquetages installés</guimenu>. Avec cette option, vous risquez de passer à côté des nouvelles fonctionnalités livrées avec la dernière version de SUSE Linux Enterprise.
      </para>
     </listitem>
     <listitem>
      <para>
       <guimenu>Mise à jour avec l'installation d'un nouveau logiciel et de nouvelles fonctionnalités</guimenu>. Cliquez sur <guimenu>Sélectionner les schémas</guimenu> si vous souhaitez personnaliser l'activation ou la désactivation des schémas et paquetages.
      </para>
     </listitem>
    </itemizedlist>

    <note>
     <title>choix du poste de travail</title>
     <para>
      Si vous utilisiez KDE avant la mise à niveau vers SUSE Linux Enterprise 12 (<varname>DEFAULT_WM)</varname> dans <filename>/etc/sysconfig/windowmanager</filename> avait été défini sur <literal>KDE*)</literal>, votre environnement de bureau sera automatiquement remplacé par GNOME après la mise à niveau. Par défaut, le gestionnaire d'affichage KDM sera remplacé par GDM.
     </para>
     <para>
      Pour modifier l'environnement de bureau ou le gestionnaire de fenêtres, sélectionnez d'autres logiciels en cliquant sur <guimenu>Sélectionner les schémas</guimenu>.
     </para>
    </note>
   </step>
   <step>
    <para>
     Si tous les paramètres vous conviennent, démarrez la procédure d'installation et de suppression en cliquant sur <guimenu>Mettre à jour</guimenu>.
    </para>
   </step>
   <step>
    <para>
     Une fois que le processus de mise à niveau a abouti, vérifiez l'éventuelle présence de <quote>paquetages orphelins</quote>. Les paquetages orphelins sont des paquetages qui n'appartiennent plus à aucun dépôt actif. La commande suivante vous permet d'obtenir une liste de ces paquetages :
    </para>
<screen>zypper packages --orphaned</screen>
    <para>
     Cette liste vous permet de déterminer si un paquetage est toujours nécessaire ou peut être désinstallé en toute sécurité.
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec.update.sle.manager">
  <title>Mise à jour via SUSE Manager</title>

  <para>
   SUSE Manager est une solution serveur pour fournir des mises à jour et des correctifs pour les clients SUSE Linux Enterprise. Il s'accompagne d'un ensemble d'outils et d'une interface utilisateur Web pour les tâches de gestion. Pour plus d'informations sur SUSE Manager, consultez l'adresse <link xlink:href="https://www.suse.com/products/suse-manager/"/>.
  </para>

  <para>
   SUSE Manager peut vous aider pour la migration d'un Service Pack ou la mise à niveau d'un système complet.
  </para>

  <variablelist>

   <varlistentry>
    <term>Migration de Service Pack</term>
    <listitem>
     <para>
      La migration de Service Pack permet de migrer d'un Service Pack (SP) vers un autre au sein d'une version principale (par exemple, à partir de SLES 12 SP1 vers SLES 12 SP2). Pour plus d'informations, consultez le manuel <citetitle>SUSE Manager Best Practices Guide</citetitle> (Guide des meilleures pratiques de SUSE Manager), chapitre <quote>Client Migration</quote> (Migration du client) :
     </para>
     <para>
       <link xlink:href="https://www.suse.com/documentation/suse-manager/"/>, version 3.1.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Mise à niveau du système</term>
    <listitem>
     <para>
      SUSE Manager vous permet d'effectuer une mise à niveau du système. Grâce à l'intégration de la technologie AutoYaST, il est possible d'effectuer des mises à niveau d'une version majeure vers l'autre (par exemple, SLES 11 SP3 vers SLES 12 SP2). Pour plus d'informations, consultez le manuel <citetitle>SUSE Manager Best Practices Guide</citetitle> (Guide des meilleures pratiques de SUSE Manager), chapitre <quote>Client Migration</quote> (Migration du client) :
     </para>
     <para>
      <link xlink:href="https://www.suse.com/documentation/suse-manager/"/>, version 3.1.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
<para>
  <remark>taroth 2018-09-26: the SUMA docs do not cover migration to
   SLE 12 SP5 yet, therefore removed the specific section title from
   the pointers above and filed https://bugzilla.suse.com/show_bug.cgi?id=1109790
 </remark>
</para>
 </sect1>
 <sect1 xml:id="sec.update.reg.status.after.rollback">
  <title>Mise à jour de l'état d'enregistrement après un retour à l'état initial</title>

  <para>
   Lorsque vous effectuez la mise à niveau d'un Service Pack, vous devez modifier la configuration sur le serveur d'enregistrement pour donner accès aux nouveaux dépôts. Si le processus de mise à niveau a été interrompu ou annulé (par le biais d'une restauration à partir d'une sauvegarde ou d'un instantané), les informations sur le serveur d'enregistrement ne reflètent pas l'état du système. Dès lors, vous risquez de ne pas avoir accès aux dépôts de mise à jour ou à des dépôts incorrects utilisés sur le client.
  </para>

  <para>
   Lorsqu'un retour à l'état initial est effectué via Snapper, le système avertit le serveur d'enregistrement pour garantir que l'accès aux dépôts appropriés est configuré au cours du processus de démarrage. Si le système a été restauré d'une autre façon ou si la communication avec le serveur d'enregistrement a échoué pour une quelconque raison (par exemple, le serveur n'était pas accessible en raison de problèmes réseau), déclenchez manuellement le retour à l'état initial sur le client en entrant la commande :
  </para>

<screen><command>snapper</command> rollback</screen>

  <para>
   Nous suggérons de toujours vérifier que les dépôts corrects sont configurés sur le système, en particulier après le rafraîchissement du service à l'aide de la commande:
  </para>

<screen><command>zypper</command> ref -s</screen>

  <para>
   Cette fonctionnalité est disponible dans le paquetage
   <package>rollback-helper</package>
   .
  </para>
 </sect1>
 <sect1 xml:id="sec.update.registersystem">


  <title>Enregistrement de votre système</title>

  <para>
   Si vous avez ignoré l'étape d'enregistrement pendant l'installation, vous pourrez enregistrer votre système par la suite à l'aide du module <guimenu>Enregistrement du produit</guimenu> de YaST.
  </para>

  <para>
   L'enregistrement de vos systèmes vous offre les avantages suivants :
  </para>

  <itemizedlist>
   <listitem>
    <para>
     Vous pouvez bénéficier du support.
    </para>
   </listitem>
   <listitem>
    <para>
     Vous avez accès aux mises à jour de sécurité et aux correctifs de bogues.
    </para>
   </listitem>
   <listitem>
    <para>
     Vous avez accès au SUSE Customer Center.
    </para>
   </listitem>
  </itemizedlist>

  <procedure>
   <step>
    <para>
     Démarrez YaST et sélectionnez <menuchoice> <guimenu>Logiciels</guimenu> <guimenu>Enregistrement du produit</guimenu> </menuchoice>pour ouvrir la boîte de dialogue <guimenu>Enregistrement</guimenu>.
    </para>
   </step>
   <step>
    <para>
     Indiquez l'<guimenu>Adresse électronique</guimenu> associée au compte SUSE que vous ou votre entreprise utilisez pour gérer les abonnements. Si vous ne disposez pas encore de compte SUSE, rendez-vous sur la page d'accueil du SUSE Customer Center (<link xlink:show="new" xlink:href="https://scc.suse.com/"/>) pour en créer un.
    </para>
   </step>
   <step>
    <para>
     Entrez le <guimenu>Code d'enregistrement</guimenu> que vous avez reçu avec votre exemplaire de <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>.
    </para>
   </step>
   <step xml:id="step.y2.register.final">
    <para>
     Pour commencer l'enregistrement, poursuivez en sélectionnant <guimenu>Suivant</guimenu>. Si un ou plusieurs serveurs d'enregistrement locaux sont disponibles sur votre réseau, vous pouvez en sélectionner un dans la liste. Vous pouvez également sélectionner <guimenu>Annuler</guimenu> pour ignorer les serveurs d'enregistrement locaux et vous enregistrer auprès du serveur SUSE par défaut.
    </para>
    <para>
     Au cours de l'enregistrement, les dépôts de mise à jour en ligne sont ajoutés à votre configuration de mise à niveau. Une fois l'opération terminée, vous pouvez choisir d'installer les versions de paquetage les plus récentes disponibles à partir de ces dépôts. Vous obtenez alors un nouveau chemin de mise à niveau pour tous les paquetages et êtes ainsi certain que <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> est mis à niveau avec les dernières mises à jour de sécurité disponibles. Si vous cliquez sur <guimenu>Non</guimenu>, tous les paquetages sont installés à partir du support d'installation. Cliquez ensuite sur <guimenu>Suivant</guimenu>.
    </para>
    <para>
     Une fois l'enregistrement réussi, YaST affiche la liste des extensions, produits complémentaires et modules disponibles pour votre système. Pour les sélectionner et les installer, passez à la <xref linkend="sec.add-ons.installation"/>.
    </para>
   </step>
  </procedure>
 </sect1>

</chapter>
