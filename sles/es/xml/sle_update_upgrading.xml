<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="sle_update_upgrading.xml" version="5.0" xml:id="cha.update.sle">
 <title>Actualización de SUSE Linux Enterprise</title>
 <info>
  <abstract>
   <para>
    SUSE® Linux Enterprise (SLE) permite actualizar un sistema existente a la nueva versión, por ejemplo, de SLE 11 SP4 al paquete de servicio más reciente de SLE 12. No es preciso realizar una nueva instalación. Los datos que ya existan, como los directorios personales y la configuración del sistema, permanecen intactos. La actualización se puede realizar desde una unidad local de CD o DVD o desde un origen de instalación de red.
   </para>

   <para>
    En este capítulo se explica cómo actualizar manualmente el sistema SUSE Linux Enterprise, ya sea mediante un DVD, la red, un proceso automatizado o SUSE Manager.
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>sí</dm:translation>
  </dm:docmanager>
 </info>
 <sect1 xml:id="sec.update.sle.paths">
  <title>Vías de actualización a SLE 12 SP5 admitidas</title>

<figure xml:id="fig.update.sle.paths-overview">
   <title>Resumen de las vías de actualización admitidas</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata os="sles" fileref="upgrade-paths.svg" width="100%" format="SVG"/>

    </imageobject>
    <imageobject role="html">
     <imagedata os="sles" fileref="upgrade-paths.png" width="80%" format="PNG"/>

    </imageobject>
   </mediaobject>
  </figure>

  <important>
   <title>no se admiten actualizaciones de arquitecturas cruzadas</title>
   <para>
    Las actualizaciones de arquitecturas cruzadas, como actualizar de una versión 32 bits de <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> a la versión 64 bits, o actualizar de big-endian a little-endian, <emphasis>no</emphasis> se admiten.
   </para>
   <para>
    Específicamente, SLE 11 en POWER (big endian) a SLE 12 SP2 en POWER (nuevo: ¡little endian!), <emphasis>no</emphasis> se admite.
   </para>
   <para>
    Además, como SUSE Linux Enterprise 12 es solo de 64 bits, las actualizaciones de cualquier sistema de 32 bits de SUSE Linux Enterprise 11 a SUSE Linux Enterprise 12 <emphasis>no</emphasis> se admiten.
   </para>
   <para>
    Para realizar una actualización entre arquitecturas, deberá realizar una instalación nueva.
   </para>
  </important>

  <note>
   <title>omisión de los paquetes de servicio</title>
   <para os="sles">
    La vía de actualización más segura es ir paso a paso e instalar de forma consecutiva todos los paquetes de servicio. En algunos casos, se admite la omisión de uno o dos paquetes de servicio durante la actualización. Para obtener más detalles, consulte <xref linkend="vl.update.paths.sle.supported"/> y la <xref linkend="fig.update.sle.paths-overview"/>. Sin embargo, se recomienda <emphasis>no</emphasis> omitir ninguno de ellos.
   </para>

  </note>

  <note>
   <title>actualización a versiones principales</title>
   <para>
    Se recomienda realizar una instalación nueva al actualizar a una nueva versión principal; por ejemplo, de SUSE Linux Enterprise 11 a SUSE Linux Enterprise 12.
   </para>
  </note>

  <variablelist xml:id="vl.update.paths.sle.supported">
   <title>Vías de actualización admitidas por versión</title>
   <varlistentry>
    <term>Actualizar de SUSE Linux Enterprise 10 (cualquier paquete de servicio o Service Pack)</term>
    <listitem>
     <para>
      No se admite ninguna vía de migración directa a SUSE Linux Enterprise 12. En este caso, se recomienda realizar una instalación nueva.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Actualización desde SUSE Linux Enterprise 11 GA / SP1 / SP2 / SP3</term>
    <listitem>
     <para>
      No se admite ninguna vía de migración directa a SUSE Linux Enterprise 12. Debe tener instalado al menos SLE 11 SP4 para poder continuar a SLE 12 SP5.
     </para>
     <para>
      Si no es posible realizar una instalación nueva, actualice primero el paquete de servicio de SLE 11 instalado a SLE 11 SP4. Estos pasos se describen en la <citetitle><citetitle>Guía de distribución</citetitle></citetitle> de SUSE Linux Enterprise 11: <link os="sles" xlink:href="https://www.suse.com/documentation/sles11/"/>.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Actualización desde SUSE Linux Enterprise 11 SP4</term>
    <listitem>
     <para>
      La actualización de SLE 11 SP4 a SLE 12 SP5 solo se admite a través de una actualización sin conexión. Consulte la <xref linkend="cha.update.offline"/> para obtener más detalles.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Actualización desde SUSE Linux Enterprise 12 GA a SP5</term>
    <listitem>
     <para>
      No se admite la actualización directa de SLE 12 GA a SP5. Actualice primero a SLE 12 <phrase os="sles">SP3 o</phrase> SP4.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Actualización desde SUSE Linux Enterprise 12 SP1 a SP5</term>
    <listitem>
     <para>
      No se admite la actualización directa desde SLE 12 SP1 a SP5. Actualice primero a SLE 12 <phrase os="sles">SP3 o</phrase> SP4.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Actualización desde SUSE Linux Enterprise 12 SP2 a SP5</term>
    <listitem>
     <para>
      No se admite la actualización directa desde SLE 12 SP2 a SP5. Actualice primero a SLE 12 <phrase os="sles">SP3 o</phrase> SP4.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Actualización desde SUSE Linux Enterprise 12 SP3 a SP5</term>
    <listitem>
     <para os="sles">
      Se admite la actualización desde SUSE Linux Enterprise 12 SP3 a SP5.
     </para>
     <para os="sled">
      No se admite la actualización directa desde SLE 12 SP3 a SP5. Actualice primero a SLE 12 SP4.
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term>Actualización desde SUSE Linux Enterprise 12 SP4 a SP5</term>
    <listitem>
     <para>
      Se admite la actualización desde SUSE Linux Enterprise 12 SP4 a SP5.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry os="sles">
    <term>Actualización desde SUSE Linux Enterprise 12 LTSS SP1 a SP5</term>
    <listitem>
     <para>
      Se admite la actualización directa desde SUSE Linux Enterprise 12 LTSS SP1 a SP5.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
 <sect1 xml:id="sec.update.sle.methods">
  <title>Actualización con conexión y sin conexión</title>
  <para>
   SUSE admite dos métodos de actualización y migración. Para obtener más información acerca de la terminología, consulte la <xref linkend="sec.update.sle.terminology"/>. Los métodos son los siguientes:
  </para>

  <variablelist>
   <varlistentry>
    <term>Con conexión</term>
    <listitem>
     <para>
      Se considera que todas las actualizaciones que se ejecutan desde el sistema en ejecución son actualizaciones con conexión. Ejemplos: se ha conectado a través del Centro de servicios al cliente de SUSE, la Herramienta de gestión de suscripciones (SMT), SUSE Manager con YaST o Zypper.
     </para>
     <para>
      Al migrar de un paquete de servicio a otro de la misma versión principal, se recomienda seguir la <xref linkend="sec.update.migr.yast.onlinemigr"/> o la <xref linkend="sec.update.migr.zypper.onlinemigr"/>.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Sin conexión</term>
    <listitem>
     <para>
      En los métodos sin conexión, normalmente se arranca otro sistema operativo desde el que se actualiza la versión instalada de SLE. Algunos ejemplos son: DVD, unidades USB, imágenes ISO, AutoYaST, <quote>RPM normal</quote> o el arranque PXE.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
  <para>
   La actualización de SUSE Linux Enterprise 11 SP4 a SUSE Linux Enterprise 12 SP5 solo se admite mediante una actualización sin conexión. Consulte la <xref linkend="cha.update.offline"/>.
  </para>
  <para>
   La actualización desde SUSE Linux Enterprise 12 LTSS SP1 a SP5 se admite con cualquier método con conexión y sin conexión. Consulte <xref linkend="cha.update.offline"/> y <xref linkend="cha.update.online"/>.
  </para>
  <important>
   <title>clientes de SUSE Manager</title>
   <para>
    Si el equipo está gestionado mediante SUSE Manager, el procedimiento de actualización se debe iniciar en la interfaz de gestión. Para obtener información, consulte: <xref linkend="sec.update.sle.manager"/>.
   </para>
  </important>
 </sect1>

 <sect1 xml:id="sec.update.prep">
  <title>Preparación del sistema</title>
  <para>
   Antes de iniciar el procedimiento de actualización, asegúrese de que el sistema está debidamente preparado. Entre otros aspectos, los preparativos requieren realizar una copia de seguridad de los datos y comprobar las notas de la versión.
  </para>

  <sect2 xml:id="sec.update.prep.update">
   <title>Asegúrese de que el sistema actual está actualizado</title>
   <para>
    Solo se admite la actualización del sistema desde el parche más reciente. Asegúrese de que están instaladas las últimas actualizaciones del sistema, ya sea ejecutando <command>zypper patch</command> o iniciando el módulo <guimenu>Actualización en línea</guimenu> de YaST.
   </para>
  </sect2>

  <sect2 xml:id="sec.update.prep.relnotes">
   <title>Lectura de las notas de la versión</title>
   <para>
    En las notas de la versión puede encontrar información adicional sobre los cambios realizados desde la versión previa de <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>. Consulte las notas de versión para comprobar lo siguiente:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      si el hardware necesita consideraciones especiales;
     </para>
    </listitem>
    <listitem>
     <para>
      si los paquetes de software usados han cambiado de forma significativa;
     </para>
    </listitem>
    <listitem>
     <para>
      si es necesario tomar precauciones especiales para la instalación.
     </para>
    </listitem>
   </itemizedlist>
   <para>
    Las notas de la versión también proporcionan información que no pudo publicarse en el manual a tiempo y notas acerca de problemas conocidos.
   </para>
   <para os="sles">
    Si va a omitir uno o varios paquetes de servicio, compruebe también las notas de la versión de esos paquetes. Normalmente, las notas solo contienen los cambios entre dos versiones consecutivas. Si solo lee las notas de la versión actual, puede perderse cambios importantes.
   </para>
   <para>
    Encontrará las notas de la versión en el directorio <filename>/usr/share/doc/release-notes</filename> o en línea en <link xlink:href="https://www.suse.com/releasenotes/"/>.
   </para>
  </sect2>
  <sect2 xml:id="sec.update.prep.backup">
   <title>Creación de una copia de seguridad</title>
   <para>
    Antes de actualizar, copie los archivos de configuración existentes en un medio independiente (un dispositivo de cinta, un disco duro extraíble, etc.) para realizar una copia de seguridad de los datos. Esta recomendación se aplica fundamentalmente a los archivos almacenados en <filename>/etc</filename> y en algunos directorios y archivos de <filename>/var</filename> y <filename>/opt</filename>. También puede ser conveniente escribir los datos de usuario del directorio <filename>/home</filename> (los directorios <envar>HOME</envar>) en un medio de copia de seguridad. Haga una copia de seguridad de esos datos como usuario <systemitem class="username">Root</systemitem>. Solo los usuarios <systemitem class="username">Root</systemitem> disponen de permiso de lectura para todos los archivos locales.
   </para>
   <para>
    Si ha seleccionado <guimenu>Actualizar un sistema existente</guimenu> como modo de instalación en YaST, puede optar por realizar una copia de seguridad (del sistema) en un momento posterior. Puede seleccionar la inclusión de todos los archivos modificados y los archivos del directorio <filename>/etc/sysconfig</filename>. Sin embargo, no se trata de una copia de seguridad completa, ya que faltarían otros directorios importantes mencionados anteriormente. Busque la copia de seguridad en el directorio <filename>/var/adm/backup</filename>.
   </para>
   <sect3 xml:id="sec.update.prep.backup.packagelist">
    <title>Lista de los paquetes y repositorios instalados</title>
    <para>
     A menudo, resulta útil disponer de una lista de paquetes instalados, por ejemplo, al realizar una instalación nueva de una versión principal nueva de SLE o al revertir a una versión anterior.
    </para>
    <para>
     Tenga en cuenta que no todos los paquetes instalados ni los repositorios utilizados están disponibles en las versiones más recientes de SUSE Linux Enterprise. Puede que algunos hayan cambiado de nombre o que se hayan sustituido. También es posible que algunos paquetes sigan estando disponibles por compatibilidad con versiones anteriores o que otros se utilicen por defecto. Por lo tanto, podría ser necesario realizar alguna modificación manual de los archivos. Esto se puede realizar con cualquier editor de textos.
    </para>
    <para>
     Cree un archivo denominado <filename>repositories.bak</filename> que contenga una lista de todos los repositorios utilizados:
    </para>
    <screen><prompt role="root">root # </prompt><command>zypper</command> lr -e repositories.bak</screen>
    <para>
     Cree también un archivo denominado <filename>installed-software.bak</filename> que contenga una lista de todos los paquetes instalados:
    </para>
    <screen><prompt role="root">root # </prompt><command>rpm</command> -qa --queryformat '%{NAME}\n' &gt; installed-software.bak</screen>
    <para>
     Realice una copia de seguridad de ambos archivos. Los repositorios y los paquetes instalados se pueden restaurar con los comandos siguientes:
    </para>
    <screen><prompt role="root">root # </prompt><command>zypper</command> ar repositories.bak
<prompt role="root">root # </prompt><command>zypper</command> install $(cat installed-software.bak)</screen>

    <note xml:id="note.update.prep.backup.package_amount">
     <title>
      la cantidad de paquetes aumenta con una actualización a una nueva versión principal
     </title>
     <para>
      Un sistema actualizado a una nueva versión principal (SLE <replaceable>X+1</replaceable>) puede contener más paquetes que el sistema inicial (SLE <replaceable>X</replaceable>). También contendrá más paquetes que una instalación nueva de SLE <replaceable>X+1</replaceable> con la misma selección de patrón. Algunos de los posibles motivos son los siguientes:
     </para>
     <itemizedlist>
      <listitem>
       <para>
        Los paquetes se han dividido para ofrecer una selección más precisa. Por ejemplo, los 37 paquetes de <package>texlive</package> de SLE 11 se dividieron en 422 paquetes en SLE 12.
       </para>
      </listitem>
      <listitem>
       <para>
        Cuando un paquete se divide en otros paquetes, se instalan todos los paquetes durante la actualización para conservar la misma funcionalidad de la versión anterior. Sin embargo, una instalación nueva de SLE <replaceable>X+1</replaceable> podría no instalar por defecto todos los paquetes.
       </para>
      </listitem>
      <listitem>
       <para>
        Los paquetes heredados de SLE <replaceable>X</replaceable> podrían conservarse por razones de compatibilidad.
       </para>
      </listitem>
      <listitem>
       <para>
        Las dependencias de paquetes y el ámbito de los patrones pueden haber cambiado.
       </para>
      </listitem>
     </itemizedlist>
    </note>
   </sect3>
  </sect2>

  <sect2 xml:id="sec.update.prep.mariadb">
   <title>Migración de la base de datos MySQL</title>
   <remark>toms 2015-09-03: already reviewed by Ondrej and Kristýna.</remark>
   <para>
    A partir de la versión SUSE Linux Enterprise 12, SUSE cambió de MySQL a MariaDB. Antes de empezar cualquier actualización, se recomienda encarecidamente realizar una copia de seguridad de la base de datos.
   </para>

   <para>
    Para realizar la migración de la base de datos, siga el siguiente procedimiento:
   </para>
   <procedure>
    <step>
     <para>
      Entre a la sesión en el equipo con SUSE Linux Enterprise 11.
     </para>
    </step>
    <step>
     <para>
      Cree un archivo de volcado de memoria:
     </para>
<screen><prompt role="root">root # </prompt><command>mysqldump</command> -u root -p --all-databases &gt; mysql_backup.sql</screen>
     <para>
      Por defecto, <command>mysqldump</command> no realiza el volcado de <literal>INFORMATION_SCHEMA</literal> ni de la base de datos <literal>performance_schema</literal>. Para obtener más información, consulte <link xlink:href="https://dev.mysql.com/doc/refman/5.5/en/mysqldump.html"/>.
     </para>
    </step>
    <step>
     <para>
      Guarde el archivo de volcado de memoria, el archivo de configuración <filename>/etc/my.cnf</filename> y el directorio <filename>/etc/mysql/</filename> para su investigación posterior (<emphasis>NO</emphasis> para la instalación) en un lugar seguro.
     </para>
    </step>
    <step>
     <para>
      Realice la actualización. Después de la actualización, el archivo de configuración anterior <filename>/etc/my.cnf</filename> seguirá intacto. Encontrará la nueva configuración en el archivo <filename>/etc/my.cnf.rpmnew</filename>.
     </para>
    </step>
    <step>
     <para>
      Configure la base de datos MariaDB según sus necesidades. <emphasis>NO</emphasis> use el archivo de configuración ni el directorio anterior, en su lugar, empléelos como recordatorios y adáptelos.
     </para>
    </step>
    <step>
     <para>
      Asegúrese de iniciar el servidor de MariaDB:
     </para>
<screen><prompt role="root">root # </prompt><command>systemctl</command> start mysql</screen>
     <para>
      Si desea iniciar el servidor de MariaDB cada vez que arranque, habilite el servicio:
     </para>
<screen><prompt role="root">root # </prompt><command>systemctl</command> enable mysql</screen>

    </step>
    <step>
     <para>
      Conéctese a la base de datos para verificar que MariaDB se está ejecutando correctamente:
     </para>
<screen><prompt role="root">root # </prompt><command>mysql</command> -u root -p</screen>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec.update.prep.postgresql">
   <title>Migración de la base de datos PostgreSQL</title>
   <para>
    Se incluye una versión más reciente de la base de datos PostgreSQL como actualización de mantenimiento. Debido al trabajo de migración necesario de la base de datos, no existe un proceso de actualización automático. Por lo tanto, el cambio de una versión a otra se debe realizar manualmente.
   </para>
   <para>
    El proceso de migración se realiza mediante el comando <command>pg_upgrade</command>, que es un método alternativo al clásico de volcado y recarga. En comparación con el método de <quote>volcado y recarga</quote>, con <command>pg_upgrade</command> la migración tarda menos tiempo.
   </para>
   <para>
    Los archivos de programa de cada versión de PostgreSQL se almacenan en directorios distintos según dicha versión. Por ejemplo, en <filename>/usr/lib/postgresql96/</filename> para la versión 9.6 y en <filename>/usr/lib/postgresql10/</filename> para la versión 10. Tenga en cuenta que la directiva de control de versiones de PostgreSQL ha cambiado entre las versiones principales 9.6 y 10. Para obtener información, consulte: <link xlink:href="https://www.postgresql.org/support/versioning/"/>.
   </para>
   <important>
    <title>actualización desde SLE 11</title>
     <para>
      Al actualizar desde SLE 11, <systemitem>postgresql94</systemitem> se desinstalará y no se podrá usar para la migración de la base de datos a una versión superior de PostgreSQL. Por lo tanto, en tal caso, asegúrese de migrar la base de datos PostgreSQL <emphasis>antes</emphasis> de actualizar el sistema.
    </para>
   </important>
   <para>
    El procedimiento siguiente describe la migración de la base de datos de la versión 9.6 a la 10. Si se utiliza una versión distinta como inicio o destino, sustituya los números de versión según sea preciso.
   </para>
   <para>
    Para realizar la migración de la base de datos, siga el siguiente procedimiento:
   </para>
   <procedure>
    <step>
     <para>
      Asegúrese de que se cumplen las siguientes condiciones previas:
     </para>
     <itemizedlist>
      <listitem>
       <para>
        Si aún no lo ha hecho, actualice todos los paquetes de la versión anterior de PostgreSQL a la más reciente mediante una actualización de mantenimiento.
       </para>
      </listitem>
      <listitem>
       <para>
        Cree una copia de seguridad de la base de datos existente.
       </para>
      </listitem>
      <listitem>
       <para>
        Instale los paquetes de la nueva versión principal de PostgreSQL. En el caso de SLE12 SP5, esto significa instalar
        <package>postgresql10-server</package>
        y todos los paquetes de los que depende.
       </para>
      </listitem>
      <listitem>
       <para>
        Instale el paquete
        <package>postgresql10-contrib</package>
        que contiene el comando <command>pg_upgrade</command>.
       </para>
      </listitem>
      <listitem>
       <para>
        Asegúrese de que dispone de suficiente espacio libre en el área de datos de PostgreSQL, que por defecto es <filename>/var/lib/pgsql/data</filename>. Si hay poco espacio, intente reducir el tamaño con los comandos siguientes de SQL en cada base de datos (esta operación puede tardar mucho tiempo):
       </para>
<screen>VACUUM FULL</screen>
      </listitem>
     </itemizedlist>
    </step>
    <step>
     <para>
      Detenga el servidor de PostgreSQL con:
     </para>
<screen><prompt role="root">root # </prompt><command>/usr/sbin/rcpostgresql</command> stop</screen>
    <para>O bien</para>
<screen><prompt role="root">root # </prompt>systemctl stop postgresql.service</screen>
    <para>(según la versión de SLE que utilice como versión de inicio para la actualización).</para>
    </step>
    <step>
     <para>
      Renombre el directorio de datos anterior:
     </para>
<screen><prompt role="root">root # </prompt><command>mv</command> /var/lib/pgsql/data /var/lib/pgsql/data.old</screen>
    </step>

    <step>
     <para>
      Inicialice la nueva instancia de la base de datos manualmente con <command>initdb</command> o iniciando y deteniendo PostgreSQL, con lo que el proceso se realizará automáticamente:
     </para>
<screen><prompt role="root">root # </prompt><command>/usr/sbin/rcpostgresql</command> start
<prompt role="root">root # </prompt><command>/usr/sbin/rcpostgresql</command> stop</screen>
     <para>O bien</para>
<screen><prompt role="root">root # </prompt>systemctl start postgresql.service
<prompt role="root">root # </prompt>systemctl stop postgresql.service</screen>
     <para>(según la versión de SLE que utilice como versión de inicio para la actualización).</para>
    </step>
    <step>
     <para>
      Si ha cambiado los archivos de configuración en la versión anterior, plantéese la posibilidad de transferir esos cambios a los nuevos archivos de configuración. Esto puede afectar a los archivos <filename>postgresql.auto.conf</filename>, <filename>postgresql.conf</filename>, <filename>pg_hba.conf</filename> y <filename>pg_ident.conf</filename>. La versión anterior de estos archivos se encuentra en <filename>/var/lib/pgsql/data.old/</filename> y las versiones nuevas en <filename>/var/lib/pgsql/data</filename>.
     </para>
     <para>
      Tenga en cuenta que no se recomienda copiar simplemente los archivos de configuración antiguos, ya que se podrían sobrescribir las opciones nuevas, los valores por defecto nuevos y los comentarios que se hayan modificado.
     </para>
    </step>
    <step>
     <para>
      Inicie el proceso de migración como el usuario <systemitem class="username">postgres</systemitem>:
     </para>
<screen><prompt role="root">root # </prompt><command>pg_upgrade</command> \
   --old-datadir "/var/lib/pgsql/data.old" \
   --new-datadir "/var/lib/pgsql/data" \
   --old-bindir "/usr/lib/postgresql96/bin/" \
   --new-bindir "/usr/lib/postgresql10/bin/"</screen>
    </step>
    <step>
     <para>
      Inicie la nueva instancia de base de datos con:
     </para>
<screen><prompt role="root">root # </prompt><command>/usr/sbin/rcpostgresql</command> start</screen>
     <para>O bien</para>
<screen><prompt role="root">root # </prompt>systemctl start postgresql.service</screen>
    </step>
    <step>
     <para>
      Compruebe si la migración se ha realizado correctamente. El ámbito de la prueba depende del caso de uso. No existe ninguna herramienta general para automatizar este paso.
     </para>
    </step>
    <step>
     <para>
      Elimine todos los paquetes anteriores de PostgreSQL y el directorio de datos antiguo:
     </para>
<screen><prompt role="root">root # </prompt><command>zypper</command> search -s postgresql96 | xargs zypper rm -u
<prompt role="root">root # </prompt><command>rm</command> -rf /var/lib/pgsql/data.old</screen>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec.update.prep.ssl">
   <title>Creación de certificados de servidor no MD5 para aplicaciones de Java</title>
   <remark>toms 2016-07-27: from bsc#970153, c#24</remark>
   <para>
    Durante la actualización de SP1 a SP2, se han inhabilitado basada en MD5 certificados como parte de una solución de seguridad. Si dispone de certificados creados como MD5, emplee los pasos siguientes para volver a crear los certificados:
   </para>

   <procedure>
    <step>
     <para>
      Abra un terminal y entre como usuario <systemitem class="username">root</systemitem>.
     </para>
    </step>
    <step>
     <para>
      Cree una clave privada:
     </para>
     <screen><prompt role="root">root # </prompt><command>openssl</command> genrsa -out server.key 1024</screen>
     <para>
      Si desea una clave más sólida, sustituya <literal>1024</literal> por un número más elevado, por ejemplo, <literal>4096</literal>.
     </para>
    </step>
    <step>
     <para>
      Cree una petición de firma de certificado (CSR):
     </para>
     <screen><prompt role="root">root # </prompt><command>openssl</command> req -new -key server.key -out server.csr</screen>
    </step>
    <step>
     <para>
      Autofirmar el certificado:
     </para>
     <screen><prompt role="root">root # </prompt><command>openssl</command> x509 -req -days 365 -in server.csr -signkey server.key -out server.crt</screen>
    </step>
    <step>
     <para>
      Cree el archivo PEM:
     </para>
     <screen><prompt role="root">root # </prompt><command>cat</command> server.key server.crt &gt; server.pem</screen>
    </step>
    <step>
     <para>Coloque los archivos<filename>Server.CRT</filename>,<filename>Server.CSR</filename>,<filename>Server.Key</filename>, y<filename>Server.PEM</filename>en los directorios respectivos las claves que puede que encuentran. Para Tomcat, por ejemplo, este directorio es<filename>/ etc/tomcat/ssl /</filename>.
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec.update.prep.vms">
   <title>Apagado de máquinas virtuales de invitado</title>
   <para>
    Si el equipo hace de Host VM Server para KVM o Xen, asegúrese de apagar correctamente cualquier Guest VM en ejecución antes de actualizar. De lo contrario, quizá no pueda acceder a los sistemas invitados tras la actualización.
   </para>
  </sect2>

  <sect2 xml:id="sec.update.prep.smt">
   <title>Compruebe el guion <command>clientSetup4SMT.sh</command> en los clientes de SMT</title>
   <para>
    Si va a migrar el sistema operativo que está registrado un servidor SMT del cliente, tiene que comprobar si la versión de la<command>clientSetup4SMT.sh</command>guión en el host está actualizado. <command>clientSetup4SMT.sh</command>de versiones anteriores de SMT no pueden gestionar a clientes de SMT 12. Si se aplican parches de software con regularidad en el servidor SMT, siempre encontrará la versión más reciente de<command>clientSetup4SMT.sh</command>en<filename>&lt; SMT_HOSTNAME&gt;/repo/tools/clientSetup4SMT.sh</filename>.
   </para>
  </sect2>

  <sect2 xml:id="sec.update.disk">
   <title>Espacio de disco</title>

   <para>
    El software tiende a crecer de una versión a la siguiente. Por lo tanto, antes de actualizar debe saber de cuánto espacio dispone en la partición. Si sospecha que se está quedando sin espacio en disco, realice una copia de seguridad de los datos antes de aumentar el espacio disponible, por ejemplo al cambiar de tamaño las particiones. No existe ninguna regla general sobre cuánto espacio debe tener cada partición. Los requisitos de espacio dependen de cada perfil de particiones concreto y del software que se seleccione.
   </para>

   <note>
    <title>comprobación automática del espacio disponible en YaST</title>
    <para>
     Durante el procedimiento de actualización, YaST comprueba cuánto espacio libre hay disponible en el disco y muestra una advertencia al usuario si la instalación puede superar esa cantidad. En ese caso, llevar a cabo la actualización puede producir que el <emphasis>sistema no puede usarse</emphasis>. Únicamente si sabe exactamente lo que está haciendo (por haberlo probado con antelación), puede omitir la advertencia y continuar la actualización.
    </para>
   </note>

   <sect3 xml:id="sec.update.disk.space">
    <title>Comprobación de espacio en disco en sistemas de archivos que no sean Btrfs</title>
    <para>
     Utilice el comando <command>df</command> para mostrar el espacio disponible en disco. Por ejemplo, en <xref linkend="aus.update.df"/>, la partición raíz es <filename>/dev/sda3</filename> (montada como <filename>/</filename>).
    </para>
    <example xml:id="aus.update.df">
     <title>Lista que se obtiene con <command>df -h</command></title>

<screen os="sles">Filesystem     Size  Used Avail Use% Mounted on
/dev/sda3       74G   22G   53G  29% /
tmpfs          506M     0  506M   0% /dev/shm
/dev/sda5      116G  5.8G  111G   5% /home
/dev/sda1       44G    4G   40G   9% /data</screen>
    </example>
   </sect3>

   <sect3 xml:id="sec.update.disk.btrfs-on-root">
    <title>Comprobación de espacio en disco en sistemas de archivos raíz Btrfs</title>
    <para>
     Si usa Btrfs como sistema de archivos raíz en su equipo, asegúrese de que hay suficiente espacio libre. En el peor de los casos, una actualización necesitará tanto espacio en disco como el que ocupa el sistema de archivos raíz actual (sin <filename>/.snapshot</filename>) para realizar una instantánea nueva. Para mostrar el disco de espacio disponible, use este comando:
    </para>
<screen><prompt role="root">root # </prompt><command>df</command> -h /</screen>
    <para>
     Compruebe también el espacio disponible en todas las demás particiones montadas. Se ha comprobado que las recomendaciones siguientes funcionan:
    </para>
    <itemizedlist>
     <listitem>
      <para>
       Para todos los sistemas de archivos, incluido Btrfs, se necesita espacio libre suficiente en el disco para descargar e instalar RPM de gran tamaño. El espacio de los RPM antiguos solo se libera después de que se instalen los RPM nuevos.
      </para>
     </listitem>
     <listitem>
      <para>
       En el caso de Btrfs con instantáneas, se necesita como mínimo el mismo espacio libre que el que ocupa la instalación actual. Se recomienda disponer del doble de espacio libre que el que ocupa la instalación actual.
      </para>
      <para>
       Si no tiene espacio libre suficiente, puede intentar suprimir instantáneas antiguas con <command>Snapper</command>:
      </para>
<screen><prompt role="root">root # </prompt><command>snapper</command> list
<prompt role="root">root # </prompt><command>snapper</command> delete NUMBER</screen>
      <para>
       Sin embargo, esto podría no ser de ayuda en todos los casos. Antes de la migración, la mayoría de las instantáneas ocupan poco espacio.
      </para>
     </listitem>
    </itemizedlist>
   </sect3>
  </sect2>
  <sect2 xml:id="sec.update.prep.multiversion">
   <title>Inhabilitación temporal de la compatibilidad multiversión del núcleo</title>
   <para>
    <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> permite instalar varias versiones del núcleo habilitando sus ajustes correspondientes en <filename>/etc/zypp/zypp.conf</filename>. Para actualizar un paquete de servicio, hay que inhabilitar de forma temporal la compatibilidad con esta función. Cuando la actualización finalice correctamente, la compatibilidad multiversión se puede volver a habilitar. Para inhabilitar la compatibilidad multiversión, comente las líneas correspondientes en <filename>/etc/zypp/zypp.conf</filename>. El resultado debe ser similar a este:
   </para>
<screen>#multiversion = provides:multiversion(kernel)
#multiversion.kernels = latest,running</screen>
   <para>
    Para volver a activar esta función después de una actualización correcta, elimine el signo de comentario. Para obtener más información acerca de la compatibilidad multiversión, consulte el <xref linkend="cha.tuning.multikernel.enable"/>.
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.update.sle.sle12zseries" os="sles">
  <title>Actualización en IBM z Systems</title>
  <para>Para actualizar una instalación de SUSE Linux Enterprise en z Systems es necesario introducir el parámetro del núcleo <command>Upgrade=1</command>, por ejemplo mediante un parmfile. Consulte la <xref linkend="sec.appdendix.parm" xrefstyle="HeadingOnPage"/>.
  </para>
 </sect1>
 <sect1 xml:id="sec.update.prep.ppc_x" os="sles" arch="power">
  <title>IBM POWER: inicio de un X Server</title>
  <para>
   En SLES 12 para IBM POWER, el gestor de pantalla está configurado para que no inicie un X Server local por defecto. Este valor se cambió en SLES 12 SP1: el gestor de pantalla inicia ahora un X Server.
  </para>
  <para>
   Para evitar problemas durante la actualización, los ajustes de <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> no cambian automáticamente. Si desea que el gestor de pantalla inicie un X Server después de la actualización, cambie la configuración de <envar>DISPLAYMANAGER_STARTS_XSERVER</envar> en <filename>/etc/sysconfig/displaymanager</filename> como se indica a continuación:
  </para>
  <screen>DISPLAYMANAGER_STARTS_XSERVER="yes"</screen>
 </sect1>
</chapter>
