<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="sle_update_offline.xml" version="5.0" xml:id="cha.update.offline">
 <title>Actualización sin conexión</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>sí</dm:translation>
  </dm:docmanager>
  <abstract>
   <para>
    En este capítulo se describe cómo actualizar una instalación existente de SUSE Linux Enterprise mediante YaST, arrancándolo desde un medio de instalación. Por ejemplo, el programa de instalación de YaST se puede iniciar desde un DVD, a través de la red, o desde el disco duro donde reside el sistema.
   </para>
  </abstract>
 </info>
 <sect1 xml:id="sec.update.offline.conceptual-overview">
  <title>Descripción conceptual</title>
  <para>
   Antes de actualizar el sistema, lea el <xref linkend="sec.update.prep"/>.
  </para>
  <para>
   Para actualizar el sistema, arranque desde un origen de instalación, como haría en el caso de una instalación nueva. Sin embargo, cuando aparece la pantalla de arranque, debe seleccionar la opción <guimenu>Actualizar</guimenu> (en lugar de <guimenu>Instalación</guimenu>). La actualización se puede iniciar desde:
  </para>

  <itemizedlist>
   <listitem>
    <formalpara>
     <title>Medios extraíbles</title>
     <para>
      Esto incluye medios como los CD, DVD o dispositivos USB de almacenamiento masivo. Para obtener más información, consulte la <xref linkend="sec.update.offline.dvd"/>.
     </para>
    </formalpara>
   </listitem>
   <listitem>
    <formalpara>
     <title>Recursos de red</title>
     <para>
      Puede arrancar desde el medio local y después seleccionar el tipo de instalación de red correspondiente, o bien arrancar mediante PXE. Para obtener más información, consulte la <xref linkend="sec.update.offline.network"/>.
     </para>
    </formalpara>
   </listitem>
  </itemizedlist>
 </sect1>


 <sect1 xml:id="sec.update.offline.dvd">
  <title>Inicio de la actualización desde un medio de instalación</title>
  <para>
   El procedimiento siguiente describe el arranque desde un DVD, pero también es posible usar otro medio de instalación local, como una imagen ISO o un dispositivo de almacenamiento masivo USB. El medio y el método de arranque que seleccione dependerán de la arquitectura del sistema y de si el equipo dispone de BIOS tradicional o UEFI.
  </para>
  <procedure xml:id="pro.update.sle12.offline.dvd">
   <title>Actualización manual desde SLE 11 SP4 a SLE 12 SP5</title>
   <step>
    <para>
     Seleccione y prepare un medio de arranque, consulte el <xref linkend="sec.i.yast2.startup"/>.
    </para>
   </step>
   <step>
    <para>
     Inserte el DVD 4 del medio de instalación de SUSE Linux Enterprise 12 SP1 y arranque el equipo. Se muestra una pantalla de <guimenu>bienvenida</guimenu>, seguida de la pantalla de arranque.
    </para>
   </step>
   <step>
    <para>
     Para iniciar el sistema, seleccione <emphasis>Actualizar</emphasis> en el menú de arranque.
    </para>
   </step>
   <step>
    <para>
     Proceda con el proceso de actualización descrito en la <xref linkend="sec.update.sle12.start.upgr.after.boot"/>.
    </para>
   </step>
  </procedure>
 </sect1>

 <sect1 xml:id="sec.update.offline.network">
  <title>Inicio de la actualización desde un origen de red</title>
  <para>
   Para iniciar una actualización desde un origen de instalación de red, compruebe que se cumplen los siguientes requisitos:
  </para>
  <variablelist>
   <title>Requisitos para actualizar desde un origen de instalación de red</title>
   <varlistentry>
    <term>Origen de instalación de red</term>
    <listitem>
     <para>
      Un origen de instalación de red se configura como se describe en el <xref linkend="cha.deployment.instserver"/>.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Conexión de red y servicios de red</term>
    <listitem>
     <para>
      Tanto el servidor de instalación como el equipo de destino deben disponer de una conexión funcional a la red. Los servicios de red necesarios son:
     </para>
     <itemizedlist>
      <listitem><para>Servicio de nombres de dominio</para></listitem>
      <listitem><para>DHCP (solo se necesita para el arranque mediante PXE, la IP se puede establecer manualmente durante la instalación)</para></listitem>
      <listitem><para>OpenSLP (opcional)</para></listitem>
     </itemizedlist>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Medio de arranque</term>
    <listitem>
     <para>
      Disponga del DVD 1 de <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> (o una imagen ISO local) a mano para arrancar el sistema de destino <emphasis>o</emphasis> un sistema de destino que se configure para arrancar mediante PXE según <xref linkend="sec.deployment.prep_boot.pxeprep" xrefstyle="HeadingOnPage"/>. Consulte el <xref linkend="cha.deployment.remoteinst"/> para obtener información más detallada sobre cómo iniciar la actualización desde un servidor remoto.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
  <sect2 xml:id="sec.update.sle.manual.network.boot-from-dvd">
   <title>Actualización manual mediante un origen de instalación de red: arranque desde DVD</title>
   <para>
    Este procedimiento describe el arranque desde un DVD como ejemplo, pero también es posible usar otro medio de instalación local, como una imagen ISO o un dispositivo de almacenamiento masivo USB. La forma de seleccionar el método de arranque y de iniciar el sistema desde el medio dependen de la arquitectura del sistema y de si el equipo cuenta con un BIOS tradicional o UEFI. Para obtener más información, consulte los enlaces siguientes.
   </para>
   <procedure xml:id="pro.update.sle.manual.network.boot-from-dvd">

    <step>
     <para>
      Inserte el DVD 4 del medio de instalación de SUSE Linux Enterprise 12 SP1 y arranque el equipo. Se muestra una pantalla de <guimenu>bienvenida</guimenu>, seguida de la pantalla de arranque.
     </para>
    </step>
    <step>
     <para>
      Seleccione el tipo de origen de instalación de red que desee usar (FTP, HTTP, NFS, SMB o SLP). Habitualmente, estas opciones se obtienen al pulsar <keycap>F4</keycap>, pero en el caso de que el equipo cuente con UEFI en lugar de un BIOS tradicional, puede ser necesario ajustar manualmente los parámetros de arranque. Para obtener más información, consulte <xref linkend="sec.i.yast2.source.net"/> en el <xref linkend="cha.inst"/>.
     </para>
    </step>
    <step>
     <para>
      Proceda con el proceso de actualización descrito en la <xref linkend="sec.update.sle12.start.upgr.after.boot"/>.
     </para>
    </step>
   </procedure>
  </sect2>
  <sect2 xml:id="sec.update.sle.manual.network.pxe-boot">
   <title>Actualización manual mediante un origen de instalación de red: arranque a través de PXE</title>
   <para>
    Para realizar una actualización desde un origen de instalación de red mediante el arranque PXE, siga este procedimiento:
   </para>
   <procedure xml:id="pro.update.sle.manual.network.pxe-boot">
    <step>
     <para>
      Ajuste la configuración del servidor DHCP para proporcionar la información de dirección necesaria para el arranque mediante PXE. Para obtener información, consulte: <xref linkend="sec.deployment.prep_boot.pxeprep"/>.
     </para>
    </step>
    <step>
     <para>
      Configure un servidor TFTP para almacenar la imagen de arranque necesaria para el arranque PXE. Use el DVD 4 del medio de instalación de SUSE Linux Enterprise 12 SP1 para ello o siga las instrucciones descritas en: <xref linkend="sec.deployment.prep_boot.tftp"/>.
     </para>
    </step>
    <step>
     <para>
      Prepare el arranque PXE y Wake-on-LAN en el equipo de destino.
     </para>
    </step>
    <step>
     <para>
      Inicie el arranque del sistema de destino y utilice el VNC para conectar de forma remota con la rutina de instalación en ejecución en ese equipo. Para obtener más información, consulte: <xref linkend="sec.deployment.remoteinst.monitor.vnc"/>.
     </para>
    </step>
    <step>
     <para>
      Proceda con el proceso de actualización descrito en la <xref linkend="sec.update.sle12.start.upgr.after.boot"/>.
     </para>
    </step>
   </procedure>
  </sect2>
 </sect1>

 <sect1 xml:id="sec.update.offline.automated">
  <title>Habilitación de la actualización automática</title>
  <para>
   El proceso de actualización se puede ejecutar de forma automática. Para habilitar la actualización automática, se debe definir el parámetro del núcleo <literal>autoupgrade=1</literal>. El parámetro se puede definir durante el arranque en el campo <literal>Opciones de arranque.</literal> Para obtener información, consulte: <link xlink:href="https://www.suse.com/documentation/sles-12/book_autoyast/data/introduction.html"/>.
  </para>
 </sect1>
 <sect1 xml:id="sec.update.sle12.start.upgr.after.boot">
  <title>Actualización de SUSE Linux Enterprise</title>
  <para>
   <remark>taroth 2014-11-13: argh, the following is terminology hell regarding
     the software strings: "upgrade"/"update" are used intermittently and
     without clear differentiation...</remark>
  </para>
  <para>
   Antes de actualizar el sistema, lea el <xref linkend="sec.update.prep"/>. Para realizar una migración automatizada, proceda como se indica:
  </para>
  <procedure>
   <step>
    <para>
     Después de arrancar (ya sea desde un medio de instalación o desde la red), seleccione la opción <guimenu>Actualizar</guimenu> en la pantalla de arranque. Si desea realizar la actualización manualmente como se describe en los pasos siguientes, debe inhabilitar el proceso de actualización automática. Consulte la <xref linkend="sec.update.offline.automated"/>.
    </para>
    <warning>
     <title>una elección equivocada puede provocar la pérdida de datos</title>
     <para>
      Si selecciona <guimenu>Instalación</guimenu> en lugar de <guimenu>Actualizar</guimenu>, más adelante se podrían perder datos. Debe tener mucho cuidado para no destruir sus particiones de datos al realizar una instalación nueva.
     </para>
     <para>
      Asegúrese de seleccionar <guimenu>Actualizar</guimenu> aquí.
     </para>
    </warning>
    <para>
     YaST inicia el sistema de instalación.
    </para>
   </step>
   <step>
    <para>
     En la pantalla <guimenu>Bienvenida,</guimenu> seleccione los valores oportunos en <guimenu>Idioma</guimenu> y <guimenu>Teclado</guimenu> y acepte el Acuerdo de licencia. Haga clic en <guimenu>Siguiente.</guimenu>
    </para>
    <para>
     YaST comprueba en las particiones si hay sistemas SUSE Linux Enterprise ya instalados.
    </para>
   </step>
   <step>
    <para>
     En la pantalla <guimenu>Seleccionar para actualizar</guimenu>, seleccione la partición que desea actualizar y haga clic en <guimenu>Siguiente</guimenu>.
    </para>
    <para>
     YaST monta la partición seleccionada y muestra todos los repositorios que encuentra en la partición que desea actualizar.
    </para>
   </step>
   <step>
    <para>
     En la pantalla <guimenu>Repositorios usados anteriormente</guimenu>, ajuste el estado de los repositorios: habilite los que desea incluir en el proceso de actualización e inhabilite los que ya no necesite. Haga clic en <guimenu>Siguiente.</guimenu>
    </para>
   </step>
   <step>
    <para>
     En la pantalla <guimenu>Registro</guimenu>, seleccione si desea registrar el sistema actualizado ahora (introduciendo los datos de registro y haciendo clic en <guimenu>Siguiente</guimenu>) o si desea <guimenu>Omitir el registro</guimenu>. Para obtener más información sobre cómo registrar el sistema, consulte la <xref linkend="sec.update.registersystem"/>.
    </para>
   </step>
   <step>
    <para>
     Revise la pantalla <guimenu>Configuración de la instalación</guimenu> de la actualización, sobre todo la sección <guimenu>Opciones de actualización</guimenu>. Elija entre las siguientes opciones:
    </para>
    <itemizedlist>
     <listitem>
      <para>
       <guimenu>Actualizar solo paquetes instalados</guimenu>. En este caso, podrían perderse las funciones nuevas incluidas en la última versión de SUSE Linux Enterprise.
      </para>
     </listitem>
     <listitem>
      <para>
       <guimenu>Actualizar con instalación de nuevo software y características</guimenu>. Haga clic en <guimenu>Seleccionar patrones</guimenu> si desea habilitar o inhabilitar los patrones y los paquetes según desee.
      </para>
     </listitem>
    </itemizedlist>

    <note>
     <title>elección del escritorio</title>
     <para>
      Si usaba KDE antes de actualizar a SUSE Linux Enterprise 12 (<varname>DEFAULT_WM</varname>en <filename>/etc/sysconfig/windowmanager</filename> se ha establecido en <literal>kde*</literal>), el entorno de escritorio se sustituirá automáticamente por GNOME después de la actualización. Por defecto, el gestor de pantalla KDM se sustituirá por GDM.
     </para>
     <para>
      Para cambiar la elección del entorno de escritorio o el gestor de ventanas, ajuste la selección del software haciendo clic en <guimenu>Seleccionar patrones</guimenu>.
     </para>
    </note>
   </step>
   <step>
    <para>
     Si está de acuerdo con todos los valores, inicie el procedimiento de instalación y eliminación haciendo clic en <guimenu>Actualizar</guimenu>.
    </para>
   </step>
   <step>
    <para>
     Cuando el proceso de actualización finalice correctamente, compruebe si hay <quote>paquetes huérfanos</quote>. Los paquetes huérfanos son paquetes que ya no pertenecen a ningún repositorio activo. El comando siguiente proporciona una lista de estos paquetes:
    </para>
<screen>zypper packages --orphaned</screen>
    <para>
     Con esta lista, puede decidir si un paquete sigue siendo necesario o si se puede desinstalar de forma segura.
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec.update.sle.manager">
  <title>Actualización a través de SUSE Manager</title>

  <para>
   SUSE Manager es una solución de servidor para proporcionar actualizaciones, parches y soluciones de seguridad para los clientes de SUSE Linux Enterprise. Incorpora un conjunto de herramientas y una interfaz de usuario Web para tareas de gestión. Consulte <link xlink:href="https://www.suse.com/products/suse-manager/"/> para obtener más información sobre SUSE Manager.
  </para>

  <para>
   SUSE Manager puede ayudarle para migrar paquetes de servicios o para realizar una actualización completa del sistema.
  </para>

  <variablelist>

   <varlistentry>
    <term>Migración de paquetes de servicios</term>
    <listitem>
     <para>
      Con este método, puede migrar desde un paquete de servicios (SP) a otro dentro de una versión principal (por ejemplo, de SLES 12 SP1 a SLES 12 SP2). Para obtener más información, consulte <citetitle>SUSE Manager Best Practices</citetitle> (Prácticas recomendadas de SUSE Manager), capítulo <quote>Client Migration</quote> (Migración del cliente):
     </para>
     <para>
       <link xlink:href="https://www.suse.com/documentation/suse-manager/"/>, versión 3.1.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Actualización del sistema</term>
    <listitem>
     <para>
      Con SUSE Manager, puede realizar una actualización del sistema. Gracias a la tecnología integrada de AutoYaST, es posible realizar actualizaciones de una versión principal a la siguiente (por ejemplo, de SLES 11 SP3 a SLES 12 SP2). Para obtener más información, consulte <citetitle>SUSE Manager Best Practices</citetitle> (Prácticas recomendadas de SUSE Manager), capítulo <quote>Client Migration</quote> (Migración del cliente)
     </para>
     <para>
      <link xlink:href="https://www.suse.com/documentation/suse-manager/"/>, versión 3.1.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
<para>
  <remark>taroth 2018-09-26: the SUMA docs do not cover migration to
   SLE 12 SP4 yet, therefore removed the specific section title from
   the pointers above and filed https://bugzilla.suse.com/show_bug.cgi?id=1109790
 </remark>
</para>
 </sect1>
 <sect1 xml:id="sec.update.reg.status.after.rollback">
  <title>Actualización del estado de registro después de la reversión</title>

  <para>
   Cuando se realiza una actualización del paquete de servicio, es necesario cambiar la configuración en el servidor de registro para proporcionar acceso a los nuevos repositorios. Si el proceso de actualización se interrumpe o se revierte (mediante la restauración desde una copia de seguridad o de una instantánea), la información del servidor de registro será incoherente con el estado del sistema. Esto puede producir que se impida al usuario el acceso a los repositorios de actualización o que se usen repositorios incorrectos en el cliente.
  </para>

  <para>
   Cuando se realiza una operación de reversión mediante Snapper, se notifica al servidor de registro para garantizar que el acceso a los repositorios correctos se haya configurado durante el proceso de arranque. Si el sistema se restaura de otra forma o si la comunicación con el servidor de registro falla por cualquier motivo (por ejemplo, porque no sea posible acceder al servidor debido a problemas de red), puede activar manualmente la reversión en el cliente mediante una llamada al comando:
  </para>

<screen><command>snapper</command> rollback</screen>

  <para>
   Se recomienda comprobar siempre que los repositorios correctos están configurados en el sistema, sobre todo después de actualizar el servicio con el comando:
  </para>

<screen><command>zypper</command> ref -s</screen>

  <para>
   Esta función está disponible en el paquete
   <package>rollback-helper</package>
   .
  </para>
 </sect1>
 <sect1 xml:id="sec.update.registersystem">


  <title>Registro del sistema</title>

  <para>
   Si omitió el paso de registro durante la instalación, puede registrar el sistema en cualquier momento mediante el módulo <guimenu>Registro del producto</guimenu> de YaST.
  </para>

  <para>
   Registrar los sistemas presenta las ventajas siguientes:
  </para>

  <itemizedlist>
   <listitem>
    <para>
     Se pueden cumplir los requisitos para recibir asistencia técnica.
    </para>
   </listitem>
   <listitem>
    <para>
     Hay disponibles actualizaciones de seguridad y correcciones de errores.
    </para>
   </listitem>
   <listitem>
    <para>
     Acceso al Centro de servicios al cliente de SUSE
    </para>
   </listitem>
  </itemizedlist>

  <procedure>
   <step>
    <para>
     Inicie YaST y seleccione <menuchoice> <guimenu>Software</guimenu> <guimenu>Registro del producto</guimenu> </menuchoice> para abrir el recuadro de diálogo <guimenu>Registro</guimenu>.
    </para>
   </step>
   <step>
    <para>
     Indique la dirección de <guimenu>correo electrónico</guimenu> asociada con la cuenta de SUSE que usted o su organización utilice para gestionar las suscripciones. En caso de que aún no tenga una cuenta de SUSE, diríjase a la página principal del Centro de servicios al cliente de SUSE (<link xlink:show="new" xlink:href="https://scc.suse.com/"/>) a fin de crear una.
    </para>
   </step>
   <step>
    <para>
     Introduzca el <guimenu>código de registro</guimenu> que recibió con la copia de <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase>.
    </para>
   </step>
   <step xml:id="step.y2.register.final">
    <para>
     Para iniciar el registro, haga clic en <guimenu>Siguiente.</guimenu> Si en la red hay más de un servidor de registro local disponible, podrá elegir uno en la lista. También puede ignorar los servidores de registro locales y registrarse con el servidor de registro de SUSE por defecto. Para ello, seleccione <guimenu>Cancelar.</guimenu>
    </para>
    <para>
     Durante el registro, los repositorios de actualización en línea se añaden a la configuración de la actualización. Cuando termine, podrá optar por instalar las versiones más recientes disponibles del paquete desde los repositorios de actualización. Esto proporciona una vía de actualización limpia para todos los paquetes y garantiza que <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> se actualiza con las últimas actualizaciones de seguridad disponibles. Si selecciona <guimenu>No,</guimenu> todos los paquetes se instalarán desde el medio de instalación. Haga clic en <guimenu>Siguiente.</guimenu>
    </para>
    <para>
     Después de registrarse correctamente, YaST muestra las extensiones, los productos adicionales y los módulos disponibles para el sistema. Para seleccionarlos e instalarlos, continúe en: <xref linkend="sec.add-ons.installation"/>.
    </para>
   </step>
  </procedure>
 </sect1>

</chapter>
