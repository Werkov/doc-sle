<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="sle_update_upgrading.xml" version="5.0" xml:id="cha.update.sle">
 <title>升級 SUSE Linux Enterprise</title>
 <info>
  <abstract>
   <para>
    SUSE® Linux Enterprise (SLE) 允許您將現有系統升級至新版本，例如，從 SLE 11 SP4 升級至最新的 SLE 12 Service Pack。不需要任何新安裝。主目錄和資料目錄以及系統組態等現有資料仍保持不變。您可以從本地 CD 或 DVD 光碟機或從中央網路安裝來源進行更新。
   </para>

   <para>
    本章介紹如何透過 DVD、網路、自動化程序或 SUSE Manager 手動升級 SUSE Linux Enterprise 系統。
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 <sect1 xml:id="sec.update.sle.paths">
  <title>受支援的 SLE 12 SP5 升級路徑</title>

<figure xml:id="fig.update.sle.paths-overview">
   <title>支援的升級路徑綜覽</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata os="sles" fileref="upgrade-paths.svg" width="100%" format="SVG"/>

    </imageobject>
    <imageobject role="html">
     <imagedata os="sles" fileref="upgrade-paths.png" width="80%" format="PNG"/>

    </imageobject>
   </mediaobject>
  </figure>

  <important>
   <title>不支援跨架構升級</title>
   <para>
    <phrase role="productname"><phrase os="sles">不</phrase></phrase>支援跨架構升級！例如,從 32 位元版本的 <emphasis>SUSE Linux Enterprise Server</emphasis> 升級到 64 位元版本，或從位元組由大到小升級到位元組由小到大。
   </para>
   <para>
    具體來說，就是<emphasis>不</emphasis>支援從 SLE 11 on POWER (位元組由大到小) 升級到 SLE 12 SP2 on POWER (新增︰位元組由小到大)。
   </para>
   <para>
    另外，由於 SUSE Linux Enterprise 12 僅提供 64 位元，所以<emphasis>不</emphasis>支援從任何 32 位元的 SUSE Linux Enterprise 11 系統升級到 SUSE Linux Enterprise 12 及更高版本。
   </para>
   <para>
    若要跨架構升級，需執行全新安裝。
   </para>
  </important>

  <note>
   <title>跳過 Service Pack</title>
   <para os="sles">
    最安全的升級路徑是逐步連續地安裝所有 Service Pack。在某些情況下，支援在升級時跳過一到兩個 Service Pack，如需詳細資料，請參閱<xref linkend="vl.update.paths.sle.supported"/>與<xref linkend="fig.update.sle.paths-overview"/>。但建議<emphasis>不要</emphasis>跳過任何 Service Pack。
   </para>

  </note>

  <note>
   <title>升級至主要版本</title>
   <para>
    建議在升級到新的主要版本時 (例如從 SUSE Linux Enterprise 11 升級到 SUSE Linux Enterprise 12)，執行全新安裝。
   </para>
  </note>

  <variablelist xml:id="vl.update.paths.sle.supported">
   <title>每個版本支援的升級路徑</title>
   <varlistentry>
    <term>從 SUSE Linux Enterprise 10 (任何 Service Pack) 升級</term>
    <listitem>
     <para>
      不支援直接移轉到 SUSE Linux Enterprise 12 的移轉路徑。在此情況下，建議執行全新安裝。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>從 SUSE Linux Enterprise 11 GA/SP1/SP2/SP3 升級</term>
    <listitem>
     <para>
      不支援直接移轉到 SUSE Linux Enterprise 12 的移轉路徑。您的版本至少需為 SLE 11 SP4，才能升級到 SLE 12 SP5。
     </para>
     <para>
      如果不能執行全新安裝，請先將已安裝的 SLE 11 Service Pack 升級到 SLE 11 SP4。《SUSE Linux Enterprise 11 <citetitle><citetitle>部署指南</citetitle></citetitle>》中說明了這些步驟︰<link os="sles" xlink:href="https://www.suse.com/documentation/sles11/"/>。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>從 SUSE Linux Enterprise 11 SP4 升級</term>
    <listitem>
     <para>
      只有透過離線升級才能從 SLE 11 SP4 升級至 SLE 12 SP5。如需詳細資訊，請參閱<xref linkend="cha.update.offline"/>。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>從 SUSE Linux Enterprise 12 GA 升級到 SP5</term>
    <listitem>
     <para>
      不支援直接從 SLE 12 GA 升級到 SP5。請先升級至 SLE 12 <phrase os="sles">SP3 或</phrase> SP4。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>從 SUSE Linux Enterprise 12 SP1 升級至 SP5</term>
    <listitem>
     <para>
      不支援直接從 SLE 12 SP1 升級至 SP5。請先升級至 SLE 12 <phrase os="sles">SP3 或</phrase> SP4。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>從 SUSE Linux Enterprise 12 SP2 升級至 SP5</term>
    <listitem>
     <para>
      不支援直接從 SLE 12 SP2 升級至 SP5。請先升級至 SLE 12 <phrase os="sles">SP3 或</phrase> SP4。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>從 SUSE Linux Enterprise 12 SP3 升級至 SP5</term>
    <listitem>
     <para>
      支援從 SUSE Linux Enterprise 12 SP3 升級至 SP5。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>從 SUSE Linux Enterprise 12 SP4 升級至 SP5</term>
    <listitem>
     <para>
      支援從 SUSE Linux Enterprise 12 SP4 升級至 SP5。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry os="sles">
    <term>從 SUSE Linux Enterprise 12 LTSS SP1 升級至 SP5</term>
    <listitem>
     <para>
      支援直接從 SUSE Linux Enterprise 12 LTSS SP1 升級至 SP5。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
 <sect1 xml:id="sec.update.sle.methods">
  <title>線上升級和離線升級</title>
  <para>
   SUSE 支援兩種不同的升級和移轉方法。如需術語的詳細資訊，請參閱<xref linkend="sec.update.sle.terminology"/>。這些方法是︰
  </para>

  <variablelist>
   <varlistentry>
    <term>線上</term>
    <listitem>
     <para>
      從正在執行的系統中執行的所有升級均視為線上升級。範例︰使用 Zypper 或 YaST 透過 SUSE Customer Center、Subscription Management Tool (SMT)、SUSE Manager 連接。
     </para>
     <para>
      在同一主要版本的 Service Pack 之間移轉時，建議使用下面兩種方法︰<xref linkend="sec.update.migr.yast.onlinemigr"/>或<xref linkend="sec.update.migr.zypper.onlinemigr"/>。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>離線</term>
    <listitem>
     <para>
      離線方法通常會將另一個作業系統開機，從中升級已安裝的 SLE 版本。範例有︰DVD、隨身碟、ISO 影像、AutoYaST、<quote>純 RPM</quote>或 PXE 開機。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
  <para>
   只有透過離線升級才能從 SUSE Linux Enterprise 11 SP4 升級到 SUSE Linux Enterprise 12 SP5。請參閱<xref linkend="cha.update.offline"/>。
  </para>
  <para>
   支援使用任何離線和線上方法從 SUSE Linux Enterprise 12 LTSS SP1 升級至 SP5。請參閱<xref linkend="cha.update.offline"/> 和<xref linkend="cha.update.online"/>。
  </para>
  <important>
   <title>SUSE Manager 用戶端</title>
   <para>
    如果您的機器由 SUSE Manager 管理，則應在管理介面中啟動升級程序。如需詳細資料，請參閱 <xref linkend="sec.update.sle.manager"/>。
   </para>
  </important>
 </sect1>

 <sect1 xml:id="sec.update.prep">
  <title>準備系統</title>
  <para>
   在開始升級程序之前，請先確認您的系統已準備妥當。此外，準備工作還包括備份資料和檢查版本說明。
  </para>

  <sect2 xml:id="sec.update.prep.update">
   <title>確定目前系統是最新的</title>
   <para>
    僅支援從最新的修補層級升級系統。執行 <command>zypper patch</command> 或啟動 YaST 模組 <guimenu>Online-Update</guimenu>，以確定已安裝最新的系統更新。
   </para>
  </sect2>

  <sect2 xml:id="sec.update.prep.relnotes">
   <title>閱讀版本說明</title>
   <para>
    在版本說明中，您可以找到其他有關自 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 的上一個版本發行後所進行的變更的資訊。檢查版本說明以瞭解︰
   </para>
   <itemizedlist>
    <listitem>
     <para>
      您的硬體是否有特殊的注意事項；
     </para>
    </listitem>
    <listitem>
     <para>
      所用的任何軟體套件是否已發生重大變更；
     </para>
    </listitem>
    <listitem>
     <para>
      是否需要對您的安裝施行特殊預防措施。
     </para>
    </listitem>
   </itemizedlist>
   <para>
    版本說明還會提供無法及時編入手冊的資訊。它們還包含有關已知問題的說明。
   </para>
   <para os="sles">
    如果您跳過了一或多個 Service Pack，另請檢查所跳過 Service Pack 的版本說明。版本說明通常僅包含兩個連續版本之間的變更。如果您只閱讀最新的版本說明，可能會遺漏某些重大變更。
   </para>
   <para>
    本地的 <filename>/usr/share/doc/release-notes</filename> 目錄中或 <link xlink:href="https://www.suse.com/releasenotes/"/> 網頁上會提供版本說明。
   </para>
  </sect2>
  <sect2 xml:id="sec.update.prep.backup">
   <title>備份</title>
   <para>
    更新之前，請先將現有的組態檔案複製到單獨的媒體 (例如磁帶裝置、可移除式硬碟等) 中，以便備份資料。此作業主要適用於儲存在 <filename>/etc</filename> 中的檔案，以及 <filename>/var</filename> 和 <filename>/opt</filename> 中的一些目錄和檔案。您最好也將 <filename>/home</filename> (即 <envar>HOME</envar> 目錄) 中的使用者資料複製到備份媒體。將此資料備份為 <systemitem class="username">root</systemitem>。只有 <systemitem class="username">root</systemitem> 才有權讀取所有本地檔案。
   </para>
   <para>
    如果您在 YaST 中選取了<guimenu>更新現有系統</guimenu>做為安裝模式，則可以選擇稍後執行 (系統) 備份。您可以選擇包含所有已修改的檔案以及 <filename>/etc/sysconfig</filename> 目錄中的檔案。不過，這並不是一個完整備份，因為缺少上述的所有其他重要目錄。您可在 <filename>/var/adm/backup</filename> 目錄中找到該備份。
   </para>
   <sect3 xml:id="sec.update.prep.backup.packagelist">
    <title>列出已安裝的套件和儲存庫</title>
    <para>
     已安裝套件清單通常很實用，例如，在全新安裝某個新的主要 SLE 版本或回復到舊版本時就是如此。
    </para>
    <para>
     請注意，並非所有已安裝的套件或使用的儲存庫在 SUSE Linux Enterprise 的較新版本中都可用。有些套件或儲存庫可能已被重新命名，有些可能已被取代。還有可能提供的一些套件只是用於舊版，而預設會使用另一個替代它的套件。因此，可能需要手動編輯一些檔案。您可使用任何文字編輯器進行編輯。
    </para>
    <para>
     建立包含全部所用儲存庫清單的檔案 <filename>repositories.bak</filename>︰
    </para>
    <screen><prompt role="root">root # </prompt><command>zypper</command> lr -e repositories.bak</screen>
    <para>
     此外，建立包含全部已安裝套件清單的檔案 <filename>installed-software.bak</filename>︰
    </para>
    <screen><prompt role="root">root # </prompt><command>rpm</command> -qa --queryformat '%{NAME}\n' &gt; installed-software.bak</screen>
    <para>
     備份這兩個檔案。使用以下指令可還原儲存庫和已安裝的套件︰
    </para>
    <screen><prompt role="root">root # </prompt><command>zypper</command> ar repositories.bak
<prompt role="root">root # </prompt><command>zypper</command> install $(cat installed-software.bak)</screen>

    <note xml:id="note.update.prep.backup.package_amount">
     <title>
      更新至新主要版本後，套件數量會隨之增加
     </title>
     <para>
      升級至新主要版本的系統 (SLE <replaceable>X+1</replaceable>) 包含的套件可能比初始系統 (SLE <replaceable>X</replaceable>) 的多， 也會比選取相同模式執行的 SLE <replaceable>X+1</replaceable> 全新安裝所包含的套件多。 原因如下︰
     </para>
     <itemizedlist>
      <listitem>
       <para>
        套件經過分割，以便使用者能更細微地選取套件。例如，SLE 11 上的 37 個 <package>texlive</package> 套件已分割成 SLE 12 上的 422 個套件。
       </para>
      </listitem>
      <listitem>
       <para>
        將某個套件分割成其他套件之後，在升級過程中會安裝所有新套件，以與舊版本保持相同的功能。但是，SLE <replaceable>X+1</replaceable> 全新安裝的新預設設定可能不會安裝所有套件。
       </para>
      </listitem>
      <listitem>
       <para>
        出於相容原因，可能會保留 SLE <replaceable>X</replaceable> 中的舊套件。
       </para>
      </listitem>
      <listitem>
       <para>
        套件相依項和模式範圍可能已發生變化。
       </para>
      </listitem>
     </itemizedlist>
    </note>
   </sect3>
  </sect2>

  <sect2 xml:id="sec.update.prep.mariadb">
   <title>移轉 MySQL 資料庫</title>
   <remark>toms 2015-09-03: already reviewed by Ondrej and Kristýna.</remark>
   <para>
    從 SUSE Linux Enterprise 12 開始，SUSE 使用 MariaDB 而不是 MySQL。在開始任何升級操作之前，強烈建議您備份資料庫。
   </para>

   <para>
    若要執行資料庫移轉，請執行以下步驟︰
   </para>
   <procedure>
    <step>
     <para>
      登入到 SUSE Linux Enterprise 11 機器。
     </para>
    </step>
    <step>
     <para>
      建立傾印檔案:
     </para>
<screen><prompt role="root">root # </prompt><command>mysqldump</command> -u root -p --all-databases &gt; mysql_backup.sql</screen>
     <para>
      依預設，<command>mysqldump</command> 不會傾印 <literal>INFORMATION_SCHEMA</literal> 或 <literal>performance_schema</literal> 資料庫。如需詳細資訊，請參閱<link xlink:href="https://dev.mysql.com/doc/refman/5.5/en/mysqldump.html"/>。
     </para>
    </step>
    <step>
     <para>
      將您的傾印檔案、組態檔案 <filename>/etc/my.cnf</filename> 以及目錄 <filename>/etc/mysql/</filename> 儲存在安全位置以供日後調查(<emphasis>不要</emphasis>用於安裝！)。
     </para>
    </step>
    <step>
     <para>
      執行升級。升級後，以前的組態檔案 <filename>/etc/my.cnf</filename> 仍將保持不變。可以在檔案 <filename>/etc/my.cnf.rpmnew</filename> 中找到新組態。
     </para>
    </step>
    <step>
     <para>
      根據需要設定 MariaDB 資料庫。<emphasis>不要</emphasis>使用以前的組態檔案和目錄，只是將其用做提醒，並對其進行改編。
     </para>
    </step>
    <step>
     <para>
      確定啟動 MariaDB 伺服器︰
     </para>
<screen><prompt role="root">root # </prompt><command>systemctl</command> start mysql</screen>
     <para>
      如果您希望每次開機時都啟動 MariaDB 伺服器，請啟用以下服務︰
     </para>
<screen><prompt role="root">root # </prompt><command>systemctl</command> enable mysql</screen>

    </step>
    <step>
     <para>
      透過連接到資料庫來驗證 MariaDB 是否正常執行︰
     </para>
<screen><prompt role="root">root # </prompt><command>mysql</command> -u root -p</screen>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec.update.prep.postgresql">
   <title>移轉 PostgreSQL 資料庫</title>
   <para>
    較新版本的 PostgreSQL 資料庫以維護更新的形式隨附。由於需要完成資料庫的移轉工作，因此無法使用自動升級程序。您必須手動完成從一個版本到另一個版本的切換。
   </para>
   <para>
    移轉程序由 <command>pg_upgrade</command> 指令 (可替代傳統的傾印再重新載入方法) 執行。與<quote>傾印再重新載入</quote>方法相比，<command>pg_upgrade</command> 可以減少移轉所耗費的時間。
   </para>
   <para>
    每個 PostgreSQL 版本的程式檔案儲存在不同版本的相關目錄中。例如，<filename>/usr/lib/postgresql96/</filename> 對應於版本 9.6，<filename>/usr/lib/postgresql10/</filename> 對應於版本 10。請注意，PostgreSQL 主要版本 9.6 與 10 的版本控制規則有所不同。如需詳細資料，請參閱 <link xlink:href="https://www.postgresql.org/support/versioning/"/>。
   </para>
   <important>
    <title>從 SLE 11 升級</title>
     <para>
      從 SLE 11 升級時，將會解除安裝 <systemitem>postgresql94</systemitem>，不可用於將資料庫移轉至更高的 PostgreSQL 版本。因此，在這種情況下，請務必先移轉 PostgreSQL 資料庫，<emphasis>然後</emphasis>再升級系統。
    </para>
   </important>
   <para>
    以下程序描述如何將資料庫從版本 9.6 移轉至版本 10。使用不同的版本做為起始或目標時，請相應地取代版本編號。
   </para>
   <para>
    若要執行資料庫移轉，請執行以下步驟︰
   </para>
   <procedure>
    <step>
     <para>
      確定滿足以下前提條件︰
     </para>
     <itemizedlist>
      <listitem>
       <para>
        如果尚未這麼做，請透過維護更新將舊 PostgreSQL 版本的任何套件升級至最新版本。
       </para>
      </listitem>
      <listitem>
       <para>
        建立現有資料庫的備份。
       </para>
      </listitem>
      <listitem>
       <para>
        安裝新 PostgreSQL 主要版本的套件。對於 SLE12 SP5，這表示需要安裝
        <package>postgresql10-server</package>
        及其相依的所有套件。
       </para>
      </listitem>
      <listitem>
       <para>
        安裝套件
        <package>postgresql10-contrib，</package>
        其中包含指令 <command>pg_upgrade</command>。
       </para>
      </listitem>
      <listitem>
       <para>
        確定 PostgreSQL 資料區域 (預設為 <filename>/var/lib/pgsql/data</filename>) 中有足夠的可用空間。如果可用空間非常有限，請對每個資料庫使用以下 SQL 指令，以嘗試減少大小 (這可能需要花費很長時間！)︰
       </para>
<screen>VACUUM FULL</screen>
      </listitem>
     </itemizedlist>
    </step>
    <step>
     <para>
      使用下列任一指令停止 PostgreSQL 伺服器︰
     </para>
<screen><prompt role="root">root # </prompt><command>/usr/sbin/rcpostgresql</command> stop</screen>
    <para>或</para>
<screen><prompt role="root">root # </prompt>systemctl stop postgresql.service</screen>
    <para>(取決於要用做升級起始版本的 SLE 版本)。</para>
    </step>
    <step>
     <para>
      重新命名舊資料目錄︰
     </para>
<screen><prompt role="root">root # </prompt><command>mv</command> /var/lib/pgsql/data /var/lib/pgsql/data.old</screen>
    </step>

    <step>
     <para>
      使用 <command>initdb</command> 手動啟始化新的資料庫例項，或者啟動再停止 PostgreSQL，如此即可自動完成啟始化︰
     </para>
<screen><prompt role="root">root # </prompt><command>/usr/sbin/rcpostgresql</command> start
<prompt role="root">root # </prompt><command>/usr/sbin/rcpostgresql</command> stop</screen>
     <para>或</para>
<screen><prompt role="root">root # </prompt>systemctl start postgresql.service
<prompt role="root">root # </prompt>systemctl stop postgresql.service</screen>
     <para>(取決於要用做升級起始版本的 SLE 版本)。</para>
    </step>
    <step>
     <para>
      如果您在舊版本中變更了組態檔案，請考慮將這些變更移至新的組態檔案。可能受影響的檔案包括 <filename>postgresql.auto.conf</filename>、<filename>postgresql.conf</filename>、<filename>pg_hba.conf</filename> 和 <filename>pg_ident.conf</filename>。這些檔案的舊版本位於 <filename>/var/lib/pgsql/data.old/</filename> 中，新版本可在 <filename>/var/lib/pgsql/data</filename> 中找到。
     </para>
     <para>
      請注意，不建議只是複製舊組態檔案，因為這麼做可能會覆寫新選項、新預設值和變更后的備註。
     </para>
    </step>
    <step>
     <para>
      以 <systemitem class="username">postgres</systemitem> 使用者身分啟動移轉程序︰
     </para>
<screen><prompt role="root">root # </prompt><command>pg_upgrade</command> \
   --old-datadir "/var/lib/pgsql/data.old" \
   --new-datadir "/var/lib/pgsql/data" \
   --old-bindir "/usr/lib/postgresql96/bin/" \
   --new-bindir "/usr/lib/postgresql10/bin/"</screen>
    </step>
    <step>
     <para>
      使用下列任一指令啟動新資料庫例項︰
     </para>
<screen><prompt role="root">root # </prompt><command>/usr/sbin/rcpostgresql</command> start</screen>
     <para>或</para>
<screen><prompt role="root">root # </prompt>systemctl start postgresql.service</screen>
    </step>
    <step>
     <para>
      檢查移轉是否成功。測試範圍取決於使用案例。沒有通用的工具可用於自動執行此步驟。
     </para>
    </step>
    <step>
     <para>
      移除所有舊 PostgreSQL 套件和舊資料目錄︰
     </para>
<screen><prompt role="root">root # </prompt><command>zypper</command> search -s postgresql96 | xargs zypper rm -u
<prompt role="root">root # </prompt><command>rm</command> -rf /var/lib/pgsql/data.old</screen>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec.update.prep.ssl">
   <title>為 Java 應用程式建立非 MD5 伺服器證書</title>
   <remark>toms 2016-07-27: from bsc#970153, c#24</remark>
   <para>
    從 SP1 升級到 SP2 期間，在進行安全性修復時停用了 MD5 式證書。若您之前建立的證書為 MD5 證書，請執行以下步驟來重新建立證書︰
   </para>

   <procedure>
    <step>
     <para>
      開啟終端機，並以 <systemitem class="username">root</systemitem> 身分登入。
     </para>
    </step>
    <step>
     <para>
      建立私密金鑰︰
     </para>
     <screen><prompt role="root">root # </prompt><command>openssl</command> genrsa -out server.key 1024</screen>
     <para>
      如需增強式金鑰，請以更大的數字 (例如 <literal>4096</literal>) 取代 <literal>1024</literal>。
     </para>
    </step>
    <step>
     <para>
      建立證書簽署申請 (CSR)︰
     </para>
     <screen><prompt role="root">root # </prompt><command>openssl</command> req -new -key server.key -out server.csr</screen>
    </step>
    <step>
     <para>
      自行簽署證書︰
     </para>
     <screen><prompt role="root">root # </prompt><command>openssl</command> x509 -req -days 365 -in server.csr -signkey server.key -out server.crt</screen>
    </step>
    <step>
     <para>
      建立 PEM 檔案︰
     </para>
     <screen><prompt role="root">root # </prompt><command>cat</command> server.key server.crt &gt; server.pem</screen>
    </step>
    <step>
     <para>將 <filename>server.crt</filename>、<filename>server.csr</filename>、<filename>server.key</filename> 與 <filename>server.pem</filename> 檔案置於可在其中找到金鑰的相應目錄中。例如，對於 Tomcat，此目錄為 <filename>/etc/tomcat/ssl/</filename>。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec.update.prep.vms">
   <title>關閉虛擬機器客體</title>
   <para>
    如果您的機器用做 KVM 或 Xen 的虛擬機器主機伺服器，請確定在更新之前，先正常關閉所有執行中的虛擬機器客體。否則，您可能會在更新之後無法存取這些客體作業系統。
   </para>
  </sect2>

  <sect2 xml:id="sec.update.prep.smt">
   <title>檢查 SMT 用戶端上的 <command>clientSetup4SMT.sh</command> 程序檔</title>
   <para>
    若要移轉針對 SMT 伺服器註冊的用戶端作業系統，則需要檢查主機上的 <command>clientSetup4SMT.sh</command> 程序檔是否為最新版本。較舊版 SMT 的 <command>clientSetup4SMT.sh</command> 無法管理 SMT 12 用戶端。如果您在 SMT 伺服器上定期套用軟體修補程式，那麼位於 <filename>&lt;SMT 主機名稱&gt;/repo/tools/clientSetup4SMT.sh</filename> 處的 <command>clientSetup4SMT.sh</command> 永遠都是最新版本。
   </para>
  </sect2>

  <sect2 xml:id="sec.update.disk">
   <title>磁碟空間</title>

   <para>
    軟體通常會隨著版本更新而擴增。因此在更新之前，請先檢視可用的分割區空間。如果您懷疑磁碟空間不足，請先備份資料，再透過調整分割區大小等方法來增大可用空間。每個分割區應該佔用多大空間並沒有常規可循。空間需求將依特定的磁碟分割設定檔和選取軟體而有差異。
   </para>

   <note>
    <title>自動檢查 YaST 中是否有足夠的空間</title>
    <para>
     在更新過程中，YaST 會檢查可用磁碟空間的容量，並在安裝大小可能超出可用空間時向使用者顯示警告。在此情況下，執行更新可能會導致<emphasis>系統無法使用</emphasis>！除非您有執行的把握 (透過事先測試取得)，您才可以跳過該警告並繼續進行更新。
    </para>
   </note>

   <sect3 xml:id="sec.update.disk.space">
    <title>檢查非 Btrfs 檔案系統上的磁碟空間</title>
    <para>
     請使用 <command>df</command> 指令列出可用的磁碟空間。例如，在 <xref linkend="aus.update.df"/> 中，根分割區為 <filename>/dev/sda3</filename> (掛接位置是 <filename>/</filename>)。
    </para>
    <example xml:id="aus.update.df">
     <title>使用 <command>df -h</command> 來列示</title>

<screen os="sles">Filesystem     Size  Used Avail Use% Mounted on
/dev/sda3       74G   22G   53G  29% /
tmpfs          506M     0  506M   0% /dev/shm
/dev/sda5      116G  5.8G  111G   5% /home
/dev/sda1       44G    4G   40G   9% /data</screen>
    </example>
   </sect3>

   <sect3 xml:id="sec.update.disk.btrfs-on-root">
    <title>檢查非 Btrfs 根檔案系統上的磁碟空間</title>
    <para>
     如果您在機器上使用 Btrfs 做為根檔案系統，請確定有足夠的可用空間。在最壞的情況下，升級程序需要將目前根檔案系統的所有磁碟空間 (不含 <filename>/.snapshot</filename>) 用於存放新快照。若要顯示可用的磁碟空間，請使用以下指令︰
    </para>
<screen><prompt role="root">root # </prompt><command>df</command> -h /</screen>
    <para>
     另外請檢查所有其他所掛接分割區上的可用空間。下列建議已證實值得採納︰
    </para>
    <itemizedlist>
     <listitem>
      <para>
       包含 Btrfs 的所有檔案系統需有足夠的可用磁碟空間用於下載和安裝大型 RPM。舊 RPM 的空間只會在安裝新 RPM 之後釋放。
      </para>
     </listitem>
     <listitem>
      <para>
       對於包含快照的 Btrfs，至少需要有目前安裝任務所需的可用空間。建議提供兩倍於目前安裝大小的可用空間。
      </para>
      <para>
       如果沒有足夠的可用空間，您可以嘗試使用 <command>snapper</command> 刪除舊快照︰
      </para>
<screen><prompt role="root">root # </prompt><command>snapper</command> list
<prompt role="root">root # </prompt><command>snapper</command> delete NUMBER</screen>
      <para>
       但是，這種做法並不總是有用。在移轉之前，大部份快照只會佔用極少的空間。
      </para>
     </listitem>
    </itemizedlist>
   </sect3>
  </sect2>
  <sect2 xml:id="sec.update.prep.multiversion">
   <title>暫時停用核心多版本支援</title>
   <para>
    <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 允許您在 <filename>/etc/zypp/zypp.conf</filename> 中啟用相應設定來安裝多個核心版本。為了升級到某個 Service Pack，需要暫時停用對此功能的支援。當更新成功完成後，可重新啟用多版本支援。若要停用多版本支援，請在 <filename>/etc/zypp/zypp.conf</filename> 中為各行加上備註。結果應類似如下內容︰
   </para>
<screen>#multiversion = provides:multiversion(kernel)
#multiversion.kernels = latest,running</screen>
   <para>
    若要在成功更新後重新啟用此功能，請移除備註符號。如需更多有關多版本支援的詳細資訊，請參閱<xref linkend="cha.tuning.multikernel.enable"/>。
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.update.sle.sle12zseries" os="sles">
  <title>在 IBM z Systems 上升級</title>
  <para>在 z Systems 上升級 SUSE Linux Enterprise 安裝需要設定 <command>Upgrade=1</command> 核心參數 (例如，透過 parmfile)。請參閱<xref linkend="sec.appdendix.parm" xrefstyle="HeadingOnPage"/>。
  </para>
 </sect1>
 <sect1 xml:id="sec.update.prep.ppc_x" os="sles" arch="power">
  <title>IBM POWER︰啟動 X 伺服器</title>
  <para>
   在 SLES 12 for IBM POWER 上，顯示管理員預設為不啟動本地 X 伺服器。此設定在 SLES 12 SP1 上則相反，即現在顯示管理員會啟動 X 伺服器。
  </para>
  <para>
   為了避免升級期間出現問題，<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise Server</phrase></phrase> 設定不會自動變更。若要讓顯示管理員在升級後啟動 X 伺服器，請依如下所示在 <filename>/etc/sysconfig/displaymanager</filename> 中變更 <envar>DISPLAYMANAGER_STARTS_XSERVER</envar> 設定︰
  </para>
  <screen>DISPLAYMANAGER_STARTS_XSERVER="yes"</screen>
 </sect1>
</chapter>
